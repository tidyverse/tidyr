<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Programming with tidyr • tidyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Programming with tidyr">
<meta name="description" content="Notes on programming with tidy evaluation as it relates to tidyr.
">
<meta property="og:description" content="Notes on programming with tidy evaluation as it relates to tidyr.
">
<meta property="og:image" content="https://tidyr.tidyverse.org/logo.png">
<meta name="robots" content="noindex">
<script defer data-domain="tidyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script><script async src="https://widget.kapa.ai/kapa-widget.bundle.js" data-button-hide="true" data-modal-disclaimer="This is a custom LLM for answering questions about dplyr, tidyr, and ggplot2. Answers are based on the contents of the documentation. Rate the answers to let us know what you think!" data-modal-ask-ai-input-placeholder="Ask me a question about dplyr, tidyr, or ggplot2." data-modal-header-bg-color="#f9f9f9" data-modal-override-open-class="open-kapa-widget" data-project-color="#365a7a" data-project-name="tidyr" data-modal-title="tidyverse AI ✨" data-project-logo="https://avatars.githubusercontent.com/u/22032646?s=200&amp;u=235532df5cf8543246812f73db051b793f868807&amp;v=4" data-user-analytics-fingerprint-enabled="true" data-bot-protection-mechanism="hcaptcha" data-website-id="34242a59-6aeb-4105-9065-86e16bf56a0f"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tidy-data.html">Tidy data</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/pivot.html">Pivoting</a></li>
    <li><a class="dropdown-item" href="../articles/rectangle.html">Rectangling</a></li>
    <li><a class="dropdown-item" href="../articles/nest.html">Nested data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2023/01/tidyr-1-3-0/">Version 1.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/02/tidyr-1-2-0/">Version 1.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/05/tidyr-1.1.0/">Version 1.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/09/tidyr-1-0-0/">Version 1.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/02/tidyr-0-8-0/">Version 0.8.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2017/08/tidyr-0.7.0/">Version 0.7.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-6-0/">Version 0.6.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-5-0/">Version 0.5.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-4-0/">Version 0.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-3-0/">Version 0.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-2-0/">Version 0.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/introducing-tidyr/">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/tidyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link open-kapa-widget" href="../#">Ask AI ✨</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Programming with tidyr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/tidyr/blob/main/vignettes/programming.Rmd" class="external-link"><code>vignettes/programming.Rmd</code></a></small>
      <div class="d-none name"><code>programming.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Most tidyr verbs use <strong>tidy evaluation</strong> to make
interactive data exploration fast and fluid. Tidy evaluation is a
special type of non-standard evaluation used throughout the tidyverse.
Here’s some typical tidyr code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">iris</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/nest.html">nest</a></span><span class="op">(</span>data <span class="op">=</span> <span class="op">!</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   Species    data             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> setosa     <span style="color: #949494;">&lt;tibble [50 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> versicolor <span style="color: #949494;">&lt;tibble [50 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> virginica  <span style="color: #949494;">&lt;tibble [50 × 4]&gt;</span></span></span></code></pre></div>
<p>Tidy evaluation is why we can use <code>!Species</code> to say “all
the columns except <code>Species</code>”, without having to quote the
column name (<code>"Species"</code>) or refer to the enclosing data
frame (<code>iris$Species</code>).</p>
<p>Two basic forms of tidy evaluation are used in tidyr:</p>
<ul>
<li><p><strong>Tidy selection</strong>: <code><a href="../reference/drop_na.html">drop_na()</a></code>,
<code><a href="../reference/fill.html">fill()</a></code>,
<code><a href="../reference/pivot_longer.html">pivot_longer()</a></code>/<code><a href="../reference/pivot_wider.html">pivot_wider()</a></code>,
<code><a href="../reference/nest.html">nest()</a></code>/<code><a href="../reference/unnest.html">unnest()</a></code>,
<code><a href="../reference/separate.html">separate()</a></code>/<code><a href="../reference/extract.html">extract()</a></code>, and <code><a href="../reference/unite.html">unite()</a></code>
let you select variables based on position, name, or type
(e.g. <code>1:3</code>, <code>starts_with("x")</code>, or
<code>is.numeric</code>). Literally, you can use all the same techniques
as with <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select()</a></code>.</p></li>
<li><p><strong>Data masking</strong>: <code><a href="../reference/expand.html">expand()</a></code>,
<code><a href="../reference/expand.html">crossing()</a></code> and <code><a href="../reference/expand.html">nesting()</a></code> let you refer to use
data variables as if they were variables in the environment (i.e. you
write <code>my_variable</code> not
<code>df$my_variable</code>).</p></li>
</ul>
<p>We focus on tidy selection here, since it’s the most common. You can
learn more about data masking in the equivalent vignette in dplyr: <a href="https://dplyr.tidyverse.org/dev/articles/programming.html" class="external-link uri">https://dplyr.tidyverse.org/dev/articles/programming.html</a>.
For other considerations when writing tidyr code in packages, please see
<code><a href="../articles/in-packages.html">vignette("in-packages")</a></code>.</p>
<p>We’ve pointed out that tidyr’s tidy evaluation interface is optimized
for interactive exploration. The flip side is that this adds some
challenges to indirect use, i.e. when you’re working inside a
<code>for</code> loop or a function. This vignette shows you how to
overcome those challenges. We’ll first go over the basics of tidy
selection and data masking, talk about how to use them indirectly, and
then show you a number of recipes to solve common problems.</p>
<p>Before we go on, we reveal the version of tidyr we’re using and make
a small dataset to use in examples.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"tidyr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '1.3.1.9000'</span></span>
<span></span>
<span><span class="va">mini_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">51</span>, <span class="fl">52</span>, <span class="fl">101</span>, <span class="fl">102</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">mini_iris</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species   </span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>          5.1         3.5          1.4         0.2 setosa    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>          4.9         3            1.4         0.2 setosa    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>          7           3.2          4.7         1.4 versicolor</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>          6.4         3.2          4.5         1.5 versicolor</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>          6.3         3.3          6           2.5 virginica </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>          5.8         2.7          5.1         1.9 virginica</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tidy-selection">Tidy selection<a class="anchor" aria-label="anchor" href="#tidy-selection"></a>
</h2>
<p>Underneath all functions that use tidy selection is the <a href="https://tidyselect.r-lib.org/" class="external-link">tidyselect</a> package. It provides
a miniature domain specific language that makes it easy to select
columns by name, position, or type. For example:</p>
<ul>
<li><p><code>select(df, 1)</code> selects the first column;
<code>select(df, last_col())</code> selects the last column.</p></li>
<li><p><code>select(df, c(a, b, c))</code> selects columns
<code>a</code>, <code>b</code>, and <code>c</code>.</p></li>
<li><p><code>select(df, starts_with("a"))</code> selects all columns
whose name starts with “a”; <code>select(df, ends_with("z"))</code>
selects all columns whose name ends with “z”.</p></li>
<li><p><code>select(df, where(is.numeric))</code> selects all numeric
columns.</p></li>
</ul>
<p>You can see more details in <code><a href="../reference/tidyr_tidy_select.html">?tidyr_tidy_select</a></code>.</p>
<div class="section level3">
<h3 id="indirection">Indirection<a class="anchor" aria-label="anchor" href="#indirection"></a>
</h3>
<p>Tidy selection makes a common task easier at the cost of making a
less common task harder. When you want to use tidy select indirectly
with the column specification stored in an intermediate variable, you’ll
need to learn some new tools. There are three main cases where this
comes up:</p>
<ul>
<li>
<p>When you have the tidy-select specification in a function
argument, you must <strong>embrace</strong> the argument by surrounding
it in doubled braces.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nest_egg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/nest.html">nest</a></span><span class="op">(</span><span class="va">df</span>, egg <span class="op">=</span> <span class="op">{</span><span class="op">{</span> <span class="va">cols</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">nest_egg</span><span class="op">(</span><span class="va">mini_iris</span>, <span class="op">!</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   Species    egg             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> setosa     <span style="color: #949494;">&lt;tibble [2 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> versicolor <span style="color: #949494;">&lt;tibble [2 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> virginica  <span style="color: #949494;">&lt;tibble [2 × 4]&gt;</span></span></span></code></pre></div>
</li>
<li>
<p>When you have a character vector of variable names, you must use
<code><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of()</a></code> or <code><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of()</a></code> depending on whether you
want the function to error if a variable is not found. These functions
allow you to write for loops or a function that takes variable names as
a character vector.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nest_egg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/nest.html">nest</a></span><span class="op">(</span><span class="va">df</span>, egg <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span><span class="op">)</span></span>
<span><span class="fu">nest_egg</span><span class="op">(</span><span class="va">mini_iris</span>, <span class="va">vars</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   Species    egg             </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> setosa     <span style="color: #949494;">&lt;tibble [2 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> versicolor <span style="color: #949494;">&lt;tibble [2 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> virginica  <span style="color: #949494;">&lt;tibble [2 × 4]&gt;</span></span></span></code></pre></div>
</li>
<li>
<p>In more complicated cases, you might want to use tidyselect
directly:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sel_vars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/eval_select.html" class="external-link">eval_select</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/enquo.html" class="external-link">enquo</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span>, <span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">sel_vars</span><span class="op">(</span><span class="va">mini_iris</span>, <span class="op">!</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width </span></span>
<span><span class="co">#&gt;            1            2            3            4</span></span></code></pre></div>
<p>Learn more in <code>vignette("tidyselect")</code>.</p>
</li>
</ul>
<p>Note that many tidyr functions use <code>...</code> so you can easily
select many variables, e.g. <code>fill(df, x, y, z)</code>. I now
believe that the disadvantages of this approach outweigh the benefits,
and that this interface would have been better as
<code>fill(df, c(x, y, z))</code>. For new functions that select
columns, please just use a single argument and not <code>...</code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, Maximilian Girlich, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
