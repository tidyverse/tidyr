<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Pivoting • tidyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pivoting">
<meta name="description" content="Learn how use the new `pivot_longer()` and `pivot_wider()` functions which change the representation of a dataset without changing the data it contains.">
<meta property="og:description" content="Learn how use the new `pivot_longer()` and `pivot_wider()` functions which change the representation of a dataset without changing the data it contains.">
<meta property="og:image" content="https://tidyr.tidyverse.org/logo.png">
<meta name="robots" content="noindex">
<script defer data-domain="tidyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidyr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tidy-data.html">Tidy data</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/pivot.html">Pivoting</a></li>
    <li><a class="dropdown-item" href="../articles/rectangle.html">Rectangling</a></li>
    <li><a class="dropdown-item" href="../articles/nest.html">Nested data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2023/01/tidyr-1-3-0/">Version 1.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/02/tidyr-1-2-0/">Version 1.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/05/tidyr-1.1.0/">Version 1.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/09/tidyr-1-0-0/">Version 1.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/02/tidyr-0-8-0/">Version 0.8.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2017/08/tidyr-0.7.0/">Version 0.7.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-6-0/">Version 0.6.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-5-0/">Version 0.5.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-4-0/">Version 0.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-3-0/">Version 0.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/tidyr-0-2-0/">Version 0.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/introducing-tidyr/">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/tidyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Pivoting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/tidyr/blob/main/vignettes/pivot.Rmd" class="external-link"><code>vignettes/pivot.Rmd</code></a></small>
      <div class="d-none name"><code>pivot.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes the use of the new
<code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> functions.
Their goal is to improve the usability of <code><a href="../reference/gather.html">gather()</a></code> and
<code><a href="../reference/spread.html">spread()</a></code>, and incorporate state-of-the-art features found
in other packages.</p>
<p>For some time, it’s been obvious that there is something
fundamentally wrong with the design of <code><a href="../reference/spread.html">spread()</a></code> and
<code><a href="../reference/gather.html">gather()</a></code>. Many people don’t find the names intuitive and
find it hard to remember which direction corresponds to spreading and
which to gathering. It also seems surprisingly hard to remember the
arguments to these functions, meaning that many people (including me!)
have to consult the documentation every time.</p>
<p>There are two important new features inspired by other R packages
that have been advancing reshaping in R:</p>
<ul>
<li><p><code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> can work with multiple value
variables that may have different types, inspired by the enhanced
<code>melt()</code> and <code>dcast()</code> functions provided by the
<a href="https://github.com/Rdatatable/data.table/wiki" class="external-link">data.table</a>
package by Matt Dowle and Arun Srinivasan.</p></li>
<li><p><code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> can
take a data frame that specifies precisely how metadata stored in column
names becomes data variables (and vice versa), inspired by the <a href="https://winvector.github.io/cdata/" class="external-link">cdata</a> package by John
Mount and Nina Zumel.</p></li>
</ul>
<p>In this vignette, you’ll learn the key ideas behind
<code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> as you see
them used to solve a variety of data reshaping challenges ranging from
simple to complex.</p>
<p>To begin we’ll load some needed packages. In real analysis code, I’d
imagine you’d do with the <code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code>, but I can’t
do that here since this vignette is embedded in a package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="longer">Longer<a class="anchor" aria-label="anchor" href="#longer"></a>
</h2>
<p><code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> makes datasets <strong>longer</strong> by
increasing the number of rows and decreasing the number of columns. I
don’t believe it makes sense to describe a dataset as being in “long
form”. Length is a relative term, and you can only say (e.g.) that
dataset A is longer than dataset B.</p>
<p><code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> is commonly needed to tidy wild-caught
datasets as they often optimise for ease of data entry or ease of
comparison rather than ease of analysis. The following sections show how
to use <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> for a wide range of realistic
datasets.</p>
<div class="section level3">
<h3 id="pew">String data in column names<a class="anchor" aria-label="anchor" href="#pew"></a>
</h3>
<p>The <code>relig_income</code> dataset stores counts based on a survey
which (among other things) asked people about their religion and annual
income:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relig_income</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 18 × 11</span></span></span>
<span><span class="co">#&gt;    religion   `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Agnostic        27        34        60        81        76       137</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Atheist         12        27        37        52        35        70</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Buddhist        27        21        30        34        33        58</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Catholic       418       617       732       670       638      <span style="text-decoration: underline;">1</span>116</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Don’t kno…      15        14        15        11        10        35</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Evangelic…     575       869      <span style="text-decoration: underline;">1</span>064       982       881      <span style="text-decoration: underline;">1</span>486</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Hindu            1         9         7         9        11        34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Historica…     228       244       236       238       197       223</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Jehovah's…      20        27        24        24        21        30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Jewish          19        19        25        25        30        95</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: `$75-100k` &lt;dbl&gt;, `$100-150k` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `&gt;150k` &lt;dbl&gt;, `Don't know/refused` &lt;dbl&gt;</span></span></span></code></pre></div>
<p>This dataset contains three variables:</p>
<ul>
<li>
<code>religion</code>, stored in the rows,</li>
<li>
<code>income</code> spread across the column names, and</li>
<li>
<code>count</code> stored in the cell values.</li>
</ul>
<p>To tidy it we use <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relig_income</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">!</span><span class="va">religion</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"income"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"count"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 180 × 3</span></span></span>
<span><span class="co">#&gt;    religion income             count</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Agnostic &lt;$10k                 27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Agnostic $10-20k               34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Agnostic $20-30k               60</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Agnostic $30-40k               81</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Agnostic $40-50k               76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Agnostic $50-75k              137</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Agnostic $75-100k             122</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Agnostic $100-150k            109</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Agnostic &gt;150k                 84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Agnostic Don't know/refused    96</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 170 more rows</span></span></span></code></pre></div>
<ul>
<li><p>The first argument is the dataset to reshape,
<code>relig_income</code>.</p></li>
<li><p><code>cols</code> describes which columns need to be reshaped. In
this case, it’s every column apart from <code>religion</code>.</p></li>
<li><p><code>names_to</code> gives the name of the variable that will be
created from the data stored in the column names,
i.e. <code>income</code>.</p></li>
<li><p><code>values_to</code> gives the name of the variable that will
be created from the data stored in the cell value,
i.e. <code>count</code>.</p></li>
</ul>
<p>Neither the <code>names_to</code> nor the <code>values_to</code>
column exists in <code>relig_income</code>, so we provide them as
strings surrounded by quotes.</p>
</div>
<div class="section level3">
<h3 id="billboard">Numeric data in column names<a class="anchor" aria-label="anchor" href="#billboard"></a>
</h3>
<p>The <code>billboard</code> dataset records the billboard rank of
songs in the year 2000. It has a form similar to the
<code>relig_income</code> data, but the data encoded in the column names
is really a number, not a string.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">billboard</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 317 × 79</span></span></span>
<span><span class="co">#&gt;    artist  track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2 Pac   Baby… 2000-02-26      87    82    72    77    87    94    99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2Ge+her The … 2000-09-02      91    87    92    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3 Door… Kryp… 2000-04-08      81    70    68    67    66    57    54</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 3 Door… Loser 2000-10-21      76    76    72    69    67    65    55</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 504 Bo… Wobb… 2000-04-15      57    34    25    17    17    31    36</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 98^0    Give… 2000-08-19      51    39    34    26    26    19     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> A*Teens Danc… 2000-07-08      97    97    96    95   100    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Aaliyah I Do… 2000-01-29      84    62    51    41    38    35    35</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Aaliyah Try … 2000-03-18      59    53    38    28    21    18    16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Adams,… Open… 2000-08-26      76    76    74    69    68    67    61</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 307 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 69 more variables: wk8 &lt;dbl&gt;, wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, …</span></span></span></code></pre></div>
<p>We can start with the same basic specification as for the
<code>relig_income</code> dataset. Here we want the names to become a
variable called <code>week</code>, and the values to become a variable
called <code>rank</code>. I also use <code>values_drop_na</code> to drop
rows that correspond to missing values. Not every song stays in the
charts for all 76 weeks, so the structure of the input data force the
creation of unnecessary explicit <code>NA</code>s.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">billboard</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"wk"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"week"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"rank"</span>,</span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5,307 × 5</span></span></span>
<span><span class="co">#&gt;    artist  track                   date.entered week   rank</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk1      87</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk2      82</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk3      72</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk4      77</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk5      87</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk6      94</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk7      99</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2Ge+her The Hardest Part Of ... 2000-09-02   wk1      91</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2Ge+her The Hardest Part Of ... 2000-09-02   wk2      87</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2Ge+her The Hardest Part Of ... 2000-09-02   wk3      92</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5,297 more rows</span></span></span></code></pre></div>
<p>It would be nice to easily determine how long each song stayed in the
charts, but to do that, we’ll need to convert the <code>week</code>
variable to an integer. We can do that by using two additional
arguments: <code>names_prefix</code> strips off the <code>wk</code>
prefix, and <code>names_transform</code> converts <code>week</code> into
an integer:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">billboard</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"wk"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"week"</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"wk"</span>,</span>
<span>    names_transform <span class="op">=</span> <span class="va">as.integer</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"rank"</span>,</span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Alternatively, you could do this with a single argument by using
<code><a href="https://readr.tidyverse.org/reference/parse_number.html" class="external-link">readr::parse_number()</a></code> which automatically strips
non-numeric components:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">billboard</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"wk"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"week"</span>,</span>
<span>    names_transform <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="va"><a href="https://readr.tidyverse.org/reference/parse_number.html" class="external-link">parse_number</a></span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"rank"</span>,</span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="many-variables-in-column-names">Many variables in column names<a class="anchor" aria-label="anchor" href="#many-variables-in-column-names"></a>
</h3>
<p>A more challenging situation occurs when you have multiple variables
crammed into the column names. For example, take the <code>who</code>
dataset:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,240 × 60</span></span></span>
<span><span class="co">#&gt;    country     iso2  iso3   year new_sp_m014 new_sp_m1524 new_sp_m2534</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>981          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>982          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>983          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>984          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>985          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>986          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>987          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>988          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>989          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,230 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 53 more variables: new_sp_m3544 &lt;dbl&gt;, new_sp_m4554 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   new_sp_m5564 &lt;dbl&gt;, new_sp_m65 &lt;dbl&gt;, new_sp_f014 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   new_sp_f1524 &lt;dbl&gt;, new_sp_f2534 &lt;dbl&gt;, new_sp_f3544 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   new_sp_f4554 &lt;dbl&gt;, new_sp_f5564 &lt;dbl&gt;, new_sp_f65 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   new_sn_m014 &lt;dbl&gt;, new_sn_m1524 &lt;dbl&gt;, new_sn_m2534 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   new_sn_m3544 &lt;dbl&gt;, new_sn_m4554 &lt;dbl&gt;, new_sn_m5564 &lt;dbl&gt;, …</span></span></span></code></pre></div>
<p><code>country</code>, <code>iso2</code>, <code>iso3</code>, and
<code>year</code> are already variables, so they can be left as is. But
the columns from <code>new_sp_m014</code> to <code>newrel_f65</code>
encode four variables in their names:</p>
<ul>
<li><p>The <code>new_</code>/<code>new</code> prefix indicates these are
counts of new cases. This dataset only contains new cases, so we’ll
ignore it here because it’s constant.</p></li>
<li><p><code>sp</code>/<code>rel</code>/<code>ep</code> describe how the
case was diagnosed.</p></li>
<li><p><code>m</code>/<code>f</code> gives the gender.</p></li>
<li><p><code>014</code>/<code>1524</code>/<code>2535</code>/<code>3544</code>/<code>4554</code>/<code>65</code>
supplies the age range.</p></li>
</ul>
<p>We can break these variables up by specifying multiple column names
in <code>names_to</code>, and then either providing
<code>names_sep</code> or <code>names_pattern</code>. Here
<code>names_pattern</code> is the most natural fit. It has a similar
interface to <code>extract</code>: you give it a regular expression
containing groups (defined by <code>()</code>) and it puts each group in
a column.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">new_sp_m014</span><span class="op">:</span><span class="va">newrel_f65</span>,</span>
<span>    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diagnosis"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span><span class="op">)</span>,</span>
<span>    names_pattern <span class="op">=</span> <span class="st">"new_?(.*)_(.)(.*)"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"count"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 405,440 × 8</span></span></span>
<span><span class="co">#&gt;    country     iso2  iso3   year diagnosis gender age   count</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        m      014      <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        m      1524     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        m      2534     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        m      3544     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        m      4554     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        m      5564     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        m      65       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        f      014      <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        f      1524     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Afghanistan AF    AFG    <span style="text-decoration: underline;">1</span>980 sp        f      2534     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 405,430 more rows</span></span></span></code></pre></div>
<p>We could go one step further use readr functions to convert the
gender and age to factors. I think this is good practice when you have
categorical variables with a known set of values.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">who</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">new_sp_m014</span><span class="op">:</span><span class="va">newrel_f65</span>,</span>
<span>    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diagnosis"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span><span class="op">)</span>,</span>
<span>    names_pattern <span class="op">=</span> <span class="st">"new_?(.*)_(.)(.*)"</span>,</span>
<span>    names_transform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      gender <span class="op">=</span> <span class="op">~</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html" class="external-link">parse_factor</a></span><span class="op">(</span><span class="va">.x</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      age <span class="op">=</span> <span class="op">~</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html" class="external-link">parse_factor</a></span><span class="op">(</span></span>
<span>        <span class="va">.x</span>,</span>
<span>        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"014"</span>, <span class="st">"1524"</span>, <span class="st">"2534"</span>, <span class="st">"3544"</span>, <span class="st">"4554"</span>, <span class="st">"5564"</span>, <span class="st">"65"</span><span class="op">)</span>,</span>
<span>        ordered <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"count"</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p>Doing it this way is a little more efficient than doing a mutate
after the fact, <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> only has to transform one
occurrence of each name where a <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> would need to
transform many repetitions.</p>
</div>
<div class="section level3">
<h3 id="multiple-observations-per-row">Multiple observations per row<a class="anchor" aria-label="anchor" href="#multiple-observations-per-row"></a>
</h3>
<p>So far, we have been working with data frames that have one
observation per row, but many important pivoting problems involve
multiple observations per row. You can usually recognise this case
because name of the column that you want to appear in the output is part
of the column name in the input. In this section, you’ll learn how to
pivot this sort of data.</p>
<p>The following example is adapted from the <a href="https://CRAN.R-project.org/package=data.table/vignettes/datatable-reshape.html" class="external-link">data.table
vignette</a>, as inspiration for tidyr’s solution to this problem.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">household</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">#&gt;   family dob_child1 dob_child2 name_child1 name_child2</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1 1998-11-26 2000-01-29 Susan       Jose       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      2 1996-06-22 <span style="color: #BB0000;">NA</span>         Mark        <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3 2002-07-11 2004-04-05 Sam         Seth       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      4 2004-10-10 2009-08-27 Craig       Khai       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      5 2000-12-05 2005-02-28 Parker      Gracie</span></span></code></pre></div>
<p>Note that we have two pieces of information (or values) for each
child: their <code>name</code> and their <code>dob</code> (date of
birth). These need to go into separate columns in the result. Again we
supply multiple variables to <code>names_to</code>, using
<code>names_sep</code> to split up each variable name. Note the special
name <code>.value</code>: this tells <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> that
that part of the column name specifies the “value” being measured (which
will become a variable in the output).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">household</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">!</span><span class="va">family</span>,</span>
<span>    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".value"</span>, <span class="st">"child"</span><span class="op">)</span>,</span>
<span>    names_sep <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 4</span></span></span>
<span><span class="co">#&gt;   family child  dob        name  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1 child1 1998-11-26 Susan </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1 child2 2000-01-29 Jose  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      2 child1 1996-06-22 Mark  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      3 child1 2002-07-11 Sam   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      3 child2 2004-04-05 Seth  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      4 child1 2004-10-10 Craig </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>      4 child2 2009-08-27 Khai  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>      5 child1 2000-12-05 Parker</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span>      5 child2 2005-02-28 Gracie</span></span></code></pre></div>
<p>Note the use of <code>values_drop_na = TRUE</code>: the input shape
forces the creation of explicit missing variables for observations that
don’t exist.</p>
<p>A similar problem problem also exists in the <code>anscombe</code>
dataset built in to base R:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anscombe</span></span>
<span><span class="co">#&gt;    x1 x2 x3 x4    y1   y2    y3    y4</span></span>
<span><span class="co">#&gt; 1  10 10 10  8  8.04 9.14  7.46  6.58</span></span>
<span><span class="co">#&gt; 2   8  8  8  8  6.95 8.14  6.77  5.76</span></span>
<span><span class="co">#&gt; 3  13 13 13  8  7.58 8.74 12.74  7.71</span></span>
<span><span class="co">#&gt; 4   9  9  9  8  8.81 8.77  7.11  8.84</span></span>
<span><span class="co">#&gt; 5  11 11 11  8  8.33 9.26  7.81  8.47</span></span>
<span><span class="co">#&gt; 6  14 14 14  8  9.96 8.10  8.84  7.04</span></span>
<span><span class="co">#&gt; 7   6  6  6  8  7.24 6.13  6.08  5.25</span></span>
<span><span class="co">#&gt; 8   4  4  4 19  4.26 3.10  5.39 12.50</span></span>
<span><span class="co">#&gt; 9  12 12 12  8 10.84 9.13  8.15  5.56</span></span>
<span><span class="co">#&gt; 10  7  7  7  8  4.82 7.26  6.42  7.91</span></span>
<span><span class="co">#&gt; 11  5  5  5  8  5.68 4.74  5.73  6.89</span></span></code></pre></div>
<p>This dataset contains four pairs of variables (<code>x1</code> and
<code>y1</code>, <code>x2</code> and <code>y2</code>, etc) that underlie
Anscombe’s quartet, a collection of four datasets that have the same
summary statistics (mean, sd, correlation etc), but have quite different
data. We want to produce a dataset with columns <code>set</code>,
<code>x</code> and <code>y</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anscombe</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    cols_vary <span class="op">=</span> <span class="st">"slowest"</span>,</span>
<span>    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".value"</span>, <span class="st">"set"</span><span class="op">)</span>,</span>
<span>    names_pattern <span class="op">=</span> <span class="st">"(.)(.)"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 44 × 3</span></span></span>
<span><span class="co">#&gt;    set       x     y</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1        10  8.04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1         8  6.95</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1        13  7.58</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1         9  8.81</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1        11  8.33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1        14  9.96</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1         6  7.24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1         4  4.26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1        12 10.8 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1         7  4.82</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre></div>
<p>Setting <code>cols_vary</code> to <code>"slowest"</code> groups the
values from columns <code>x1</code> and <code>y1</code> together in the
rows of the output before moving on to <code>x2</code> and
<code>y2</code>. This argument often produces more intuitively ordered
output when you are pivoting every column in your dataset.</p>
<p>A similar situation can arise with panel data. For example, take this
example dataset provided by <a href="https://github.com/gesistsa/rio/issues/193" class="external-link">Thomas Leeper</a>. We
can tidy it using the same approach as for <code>anscombe</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pnl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>,<span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  y1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  y2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  z1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  z2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pnl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".value"</span>, <span class="st">"time"</span><span class="op">)</span>,</span>
<span>    names_pattern <span class="op">=</span> <span class="st">"(.)(.)"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 6</span></span></span>
<span><span class="co">#&gt;       x     a     b time         y     z</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1     1     0 1     -<span style="color: #BB0000;">1.40</span>        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1     1     0 2      0.622      -<span style="color: #BB0000;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     2     1     1 1      0.255       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     2     1     1 2      1.15       -<span style="color: #BB0000;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     3     0     1 1     -<span style="color: #BB0000;">2.44</span>        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     3     0     1 2     -<span style="color: #BB0000;">1.82</span>       -<span style="color: #BB0000;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     4     0     1 1     -<span style="color: #BB0000;">0.005</span><span style="color: #BB0000; text-decoration: underline;">57</span>     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>     4     0     1 2     -<span style="color: #BB0000;">0.247</span>      -<span style="color: #BB0000;">2</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="wider">Wider<a class="anchor" aria-label="anchor" href="#wider"></a>
</h2>
<p><code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> is the opposite of
<code><a href="../reference/pivot_longer.html">pivot_longer()</a></code>: it makes a dataset <strong>wider</strong>
by increasing the number of columns and decreasing the number of rows.
It’s relatively rare to need <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> to make tidy
data, but it’s often useful for creating summary tables for
presentation, or data in a format needed by other tools.</p>
<div class="section level3">
<h3 id="capture-recapture-data">Capture-recapture data<a class="anchor" aria-label="anchor" href="#capture-recapture-data"></a>
</h3>
<p>The <code>fish_encounters</code> dataset, contributed by <a href="https://fishsciences.github.io/post/visualizing-fish-encounter-histories/" class="external-link">Myfanwy
Johnston</a>, describes when fish swimming down a river are detected by
automatic monitoring stations:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish_encounters</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 114 × 3</span></span></span>
<span><span class="co">#&gt;    fish  station  seen</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 4842  Release     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 4842  I80_1       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 4842  Lisbon      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4842  Rstr        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4842  Base_TD     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 4842  BCE         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 4842  BCW         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 4842  BCE2        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 4842  BCW2        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 4842  MAE         1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 104 more rows</span></span></span></code></pre></div>
<p>Many tools used to analyse this data need it in a form where each
station is a column:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish_encounters</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">station</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">seen</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19 × 12</span></span></span>
<span><span class="co">#&gt;    fish  Release I80_1 Lisbon  Rstr Base_TD   BCE   BCW  BCE2  BCW2</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 4842        1     1      1     1       1     1     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 4843        1     1      1     1       1     1     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 4844        1     1      1     1       1     1     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4845        1     1      1     1       1    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4847        1     1      1    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 4848        1     1      1     1      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 4849        1     1     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 4850        1     1     <span style="color: #BB0000;">NA</span>     1       1     1     1    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 4851        1     1     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 4854        1     1     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: MAE &lt;int&gt;, MAW &lt;int&gt;</span></span></span></code></pre></div>
<p>This dataset only records when a fish was detected by the station -
it doesn’t record when it wasn’t detected (this is common with this type
of data). That means the output data is filled with <code>NA</code>s.
However, in this case we know that the absence of a record means that
the fish was not <code>seen</code>, so we can ask
<code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> to fill these missing values in with
zeros:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish_encounters</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">station</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">seen</span>,</span>
<span>    values_fill <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19 × 12</span></span></span>
<span><span class="co">#&gt;    fish  Release I80_1 Lisbon  Rstr Base_TD   BCE   BCW  BCE2  BCW2</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 4842        1     1      1     1       1     1     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 4843        1     1      1     1       1     1     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 4844        1     1      1     1       1     1     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4845        1     1      1     1       1     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4847        1     1      1     0       0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 4848        1     1      1     1       0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 4849        1     1      0     0       0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 4850        1     1      0     1       1     1     1     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 4851        1     1      0     0       0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 4854        1     1      0     0       0     0     0     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: MAE &lt;int&gt;, MAW &lt;int&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aggregation">Aggregation<a class="anchor" aria-label="anchor" href="#aggregation"></a>
</h3>
<p>You can also use <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> to perform simple
aggregation. For example, take the <code>warpbreaks</code> dataset built
in to base R (converted to a tibble for the better print method):</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">warpbreaks</span> <span class="op">&lt;-</span> <span class="va">warpbreaks</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">wool</span>, <span class="va">tension</span>, <span class="va">breaks</span><span class="op">)</span></span>
<span><span class="va">warpbreaks</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 54 × 3</span></span></span>
<span><span class="co">#&gt;    wool  tension breaks</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> A     L           26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> A     L           30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> A     L           54</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> A     L           25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> A     L           70</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> A     L           52</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> A     L           51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> A     L           26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> A     L           67</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> A     M           18</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 44 more rows</span></span></span></code></pre></div>
<p>This is a designed experiment with nine replicates for every
combination of <code>wool</code> (<code>A</code> and <code>B</code>) and
<code>tension</code> (<code>L</code>, <code>M</code>,
<code>H</code>):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">warpbreaks</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">wool</span>, <span class="va">tension</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   wool  tension     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A     L           9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> A     M           9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> A     H           9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> B     L           9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> B     M           9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> B     H           9</span></span></code></pre></div>
<p>What happens if we attempt to pivot the levels of <code>wool</code>
into the columns?</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">warpbreaks</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">wool</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">breaks</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Values from `breaks` are not uniquely identified; output will contain</span></span>
<span><span class="co">#&gt; list-cols.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> Use `values_fn = list` to suppress this warning.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> Use `values_fn = {summary_fun}` to summarise duplicates.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> Use the following dplyr code to identify duplicates.</span></span>
<span><span class="co">#&gt;   {data} |&gt;</span></span>
<span><span class="co">#&gt;   dplyr::summarise(n = dplyr::n(), .by = c(tension, wool)) |&gt;</span></span>
<span><span class="co">#&gt;   dplyr::filter(n &gt; 1L)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   tension A         B        </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> L       <span style="color: #949494;">&lt;dbl [9]&gt;</span> <span style="color: #949494;">&lt;dbl [9]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> M       <span style="color: #949494;">&lt;dbl [9]&gt;</span> <span style="color: #949494;">&lt;dbl [9]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> H       <span style="color: #949494;">&lt;dbl [9]&gt;</span> <span style="color: #949494;">&lt;dbl [9]&gt;</span></span></span></code></pre></div>
<p>We get a warning that each cell in the output corresponds to multiple
cells in the input. The default behaviour produces list-columns, which
contain all the individual values. A more useful output would be summary
statistics, e.g. <code>mean</code> breaks for each combination of wool
and tension:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">warpbreaks</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">wool</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">breaks</span>,</span>
<span>    values_fn <span class="op">=</span> <span class="va">mean</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   tension     A     B</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> L        44.6  28.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> M        24    28.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> H        24.6  18.8</span></span></code></pre></div>
<p>For more complex summary operations, I recommend summarising before
reshaping, but for simple cases it’s often convenient to summarise
within <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="generate-column-name-from-multiple-variables">Generate column name from multiple variables<a class="anchor" aria-label="anchor" href="#generate-column-name-from-multiple-variables"></a>
</h3>
<p>Imagine, as in <a href="https://stackoverflow.com/questions/24929954" class="external-link uri">https://stackoverflow.com/questions/24929954</a>, that we
have information containing the combination of product, country, and
year. In tidy form it might look like this:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">production</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/expand_grid.html">expand_grid</a></span><span class="op">(</span></span>
<span>    product <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>    country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AI"</span>, <span class="st">"EI"</span><span class="op">)</span>,</span>
<span>    year <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2014</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">product</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">&amp;</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"AI"</span><span class="op">)</span> <span class="op">|</span> <span class="va">product</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>production <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">production</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 45 × 4</span></span></span>
<span><span class="co">#&gt;    product country  year production</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> A       AI       <span style="text-decoration: underline;">2</span>000    -<span style="color: #BB0000;">0.244</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> A       AI       <span style="text-decoration: underline;">2</span>001    -<span style="color: #BB0000;">0.283</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> A       AI       <span style="text-decoration: underline;">2</span>002    -<span style="color: #BB0000;">0.554</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> A       AI       <span style="text-decoration: underline;">2</span>003     0.629 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> A       AI       <span style="text-decoration: underline;">2</span>004     2.07  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> A       AI       <span style="text-decoration: underline;">2</span>005    -<span style="color: #BB0000;">1.63</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> A       AI       <span style="text-decoration: underline;">2</span>006     0.512 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> A       AI       <span style="text-decoration: underline;">2</span>007    -<span style="color: #BB0000;">1.86</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> A       AI       <span style="text-decoration: underline;">2</span>008    -<span style="color: #BB0000;">0.522</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> A       AI       <span style="text-decoration: underline;">2</span>009    -<span style="color: #BB0000;">0.052</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 35 more rows</span></span></span></code></pre></div>
<p>We want to widen the data so we have one column for each combination
of <code>product</code> and <code>country</code>. The key is to specify
multiple variables for <code>names_from</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">production</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">product</span>, <span class="va">country</span><span class="op">)</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">production</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 4</span></span></span>
<span><span class="co">#&gt;     year    A_AI    B_AI    B_EI</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>000 -<span style="color: #BB0000;">0.244</span>   0.738  -<span style="color: #BB0000;">0.313</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>001 -<span style="color: #BB0000;">0.283</span>   1.89    1.07  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>002 -<span style="color: #BB0000;">0.554</span>  -<span style="color: #BB0000;">0.097</span><span style="color: #BB0000; text-decoration: underline;">4</span>  0.070<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>003  0.629  -<span style="color: #BB0000;">0.936</span>  -<span style="color: #BB0000;">0.639</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>004  2.07   -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span> -<span style="color: #BB0000;">0.050</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>005 -<span style="color: #BB0000;">1.63</span>   -<span style="color: #BB0000;">0.827</span>  -<span style="color: #BB0000;">0.251</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>006  0.512  -<span style="color: #BB0000;">1.51</span>    0.445 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>007 -<span style="color: #BB0000;">1.86</span>    0.935   2.76  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>008 -<span style="color: #BB0000;">0.522</span>   0.176   0.046<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>009 -<span style="color: #BB0000;">0.052</span><span style="color: #BB0000; text-decoration: underline;">6</span>  0.244   0.578 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more rows</span></span></span></code></pre></div>
<p>When either <code>names_from</code> or <code>values_from</code>
select multiple variables, you can control how the column names in the
output constructed with <code>names_sep</code> and
<code>names_prefix</code>, or the workhorse <code>names_glue</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">production</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">product</span>, <span class="va">country</span><span class="op">)</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">production</span>,</span>
<span>    names_sep <span class="op">=</span> <span class="st">"."</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"prod."</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 4</span></span></span>
<span><span class="co">#&gt;     year prod.A.AI prod.B.AI prod.B.EI</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>000   -<span style="color: #BB0000;">0.244</span>     0.738    -<span style="color: #BB0000;">0.313</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>001   -<span style="color: #BB0000;">0.283</span>     1.89      1.07  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>002   -<span style="color: #BB0000;">0.554</span>    -<span style="color: #BB0000;">0.097</span><span style="color: #BB0000; text-decoration: underline;">4</span>    0.070<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>003    0.629    -<span style="color: #BB0000;">0.936</span>    -<span style="color: #BB0000;">0.639</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>004    2.07     -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span>   -<span style="color: #BB0000;">0.050</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>005   -<span style="color: #BB0000;">1.63</span>     -<span style="color: #BB0000;">0.827</span>    -<span style="color: #BB0000;">0.251</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>006    0.512    -<span style="color: #BB0000;">1.51</span>      0.445 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>007   -<span style="color: #BB0000;">1.86</span>      0.935     2.76  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>008   -<span style="color: #BB0000;">0.522</span>     0.176     0.046<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>009   -<span style="color: #BB0000;">0.052</span><span style="color: #BB0000; text-decoration: underline;">6</span>    0.244     0.578 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more rows</span></span></span>
<span></span>
<span><span class="va">production</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">product</span>, <span class="va">country</span><span class="op">)</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">production</span>,</span>
<span>    names_glue <span class="op">=</span> <span class="st">"prod_{product}_{country}"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 4</span></span></span>
<span><span class="co">#&gt;     year prod_A_AI prod_B_AI prod_B_EI</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>000   -<span style="color: #BB0000;">0.244</span>     0.738    -<span style="color: #BB0000;">0.313</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>001   -<span style="color: #BB0000;">0.283</span>     1.89      1.07  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>002   -<span style="color: #BB0000;">0.554</span>    -<span style="color: #BB0000;">0.097</span><span style="color: #BB0000; text-decoration: underline;">4</span>    0.070<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>003    0.629    -<span style="color: #BB0000;">0.936</span>    -<span style="color: #BB0000;">0.639</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>004    2.07     -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">0</span>   -<span style="color: #BB0000;">0.050</span><span style="color: #BB0000; text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>005   -<span style="color: #BB0000;">1.63</span>     -<span style="color: #BB0000;">0.827</span>    -<span style="color: #BB0000;">0.251</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>006    0.512    -<span style="color: #BB0000;">1.51</span>      0.445 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>007   -<span style="color: #BB0000;">1.86</span>      0.935     2.76  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>008   -<span style="color: #BB0000;">0.522</span>     0.176     0.046<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>009   -<span style="color: #BB0000;">0.052</span><span style="color: #BB0000; text-decoration: underline;">6</span>    0.244     0.578 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tidy-census">Tidy census<a class="anchor" aria-label="anchor" href="#tidy-census"></a>
</h3>
<p>The <code>us_rent_income</code> dataset contains information about
median income and rent for each state in the US for 2017 (from the
American Community Survey, retrieved with the <a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a> package).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_rent_income</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 104 × 5</span></span></span>
<span><span class="co">#&gt;    GEOID NAME       variable estimate   moe</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01    Alabama    income      <span style="text-decoration: underline;">24</span>476   136</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 01    Alabama    rent          747     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 02    Alaska     income      <span style="text-decoration: underline;">32</span>940   508</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 02    Alaska     rent         <span style="text-decoration: underline;">1</span>200    13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 04    Arizona    income      <span style="text-decoration: underline;">27</span>517   148</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 04    Arizona    rent          972     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 05    Arkansas   income      <span style="text-decoration: underline;">23</span>789   165</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 05    Arkansas   rent          709     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 06    California income      <span style="text-decoration: underline;">29</span>454   109</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 06    California rent         <span style="text-decoration: underline;">1</span>358     3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 94 more rows</span></span></span></code></pre></div>
<p>Here both <code>estimate</code> and <code>moe</code> are values
columns, so we can supply them to <code>values_from</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_rent_income</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">variable</span>,</span>
<span>    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="va">moe</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 52 × 6</span></span></span>
<span><span class="co">#&gt;    GEOID NAME         estimate_income estimate_rent moe_income moe_rent</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01    Alabama                <span style="text-decoration: underline;">24</span>476           747        136        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 02    Alaska                 <span style="text-decoration: underline;">32</span>940          <span style="text-decoration: underline;">1</span>200        508       13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 04    Arizona                <span style="text-decoration: underline;">27</span>517           972        148        4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 05    Arkansas               <span style="text-decoration: underline;">23</span>789           709        165        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 06    California             <span style="text-decoration: underline;">29</span>454          <span style="text-decoration: underline;">1</span>358        109        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 08    Colorado               <span style="text-decoration: underline;">32</span>401          <span style="text-decoration: underline;">1</span>125        109        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 09    Connecticut            <span style="text-decoration: underline;">35</span>326          <span style="text-decoration: underline;">1</span>123        195        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 10    Delaware               <span style="text-decoration: underline;">31</span>560          <span style="text-decoration: underline;">1</span>076        247       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 11    District of…           <span style="text-decoration: underline;">43</span>198          <span style="text-decoration: underline;">1</span>424        681       17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 12    Florida                <span style="text-decoration: underline;">25</span>952          <span style="text-decoration: underline;">1</span>077         70        3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 42 more rows</span></span></span></code></pre></div>
<p>Note that the name of the variable is automatically appended to the
output columns.</p>
</div>
<div class="section level3">
<h3 id="implicit-missing-values">Implicit missing values<a class="anchor" aria-label="anchor" href="#implicit-missing-values"></a>
</h3>
<p>Occasionally, you’ll come across data where your names variable is
encoded as a factor, but not all of the data will be represented.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weekdays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mon"</span>, <span class="st">"Tue"</span>, <span class="st">"Wed"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Sat"</span>, <span class="st">"Sun"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">daily</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tue"</span>, <span class="st">"Thu"</span>, <span class="st">"Fri"</span>, <span class="st">"Mon"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">weekdays</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">daily</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   day   value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Tue       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Thu       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Fri       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Mon       5</span></span></code></pre></div>
<p><code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> defaults to generating columns from the
values that are actually represented in the data, but you might want to
include a column for each possible level in case the data changes in the
future.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">day</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;     Tue   Thu   Fri   Mon</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     2     3     1     5</span></span></code></pre></div>
<p>The <code>names_expand</code> argument will turn implicit factor
levels into explicit ones, forcing them to be represented in the result.
It also sorts the column names using the level order, which produces
more intuitive results in this case.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">day</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span>,</span>
<span>    names_expand <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;     Mon   Tue   Wed   Thu   Fri   Sat   Sun</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     5     2    <span style="color: #BB0000;">NA</span>     3     1    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>If multiple <code>names_from</code> columns are provided,
<code>names_expand</code> will generate a Cartesian product of all
possible combinations of the <code>names_from</code> values. Notice that
the following data has omitted some rows where the percentage value
would be <code>0</code>. <code>names_expand</code> allows us to make
those explicit during the pivot.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">percentages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2018</span>, <span class="fl">2019</span>, <span class="fl">2020</span>, <span class="fl">2020</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">40</span>, <span class="fl">60</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">percentages</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;    year type  percentage</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>018 A            100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>019 B            100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>020 A             40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>020 B             60</span></span>
<span></span>
<span><span class="va">percentages</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">type</span><span class="op">)</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">percentage</span>,</span>
<span>    names_expand <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    values_fill <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   `2018_A` `2018_B` `2019_A` `2019_B` `2020_A` `2020_B`</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      100        0        0      100       40       60</span></span></code></pre></div>
<p>A related problem can occur when there are implicit missing factor
levels or combinations in the <code>id_cols</code>. In this case, there
are missing rows (rather than columns) that you’d like to explicitly
represent. For this example, we’ll modify our <code>daily</code> data
with a <code>type</code> column, and pivot on that instead, keeping
<code>day</code> as an id column.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">daily</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">daily</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   day   value type </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Tue       2 A    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Thu       3 B    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Fri       1 B    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Mon       5 A</span></span></code></pre></div>
<p>All of our <code>type</code> levels are represented in the columns,
but we are missing some rows related to the unrepresented
<code>day</code> factor levels.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">type</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span>,</span>
<span>    values_fill <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   day       A     B</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Tue       2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Thu       0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Fri       0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Mon       5     0</span></span></code></pre></div>
<p>We can use <code>id_expand</code> in the same way that we used
<code>names_expand</code>, which will expand out (and sort) the implicit
missing rows in the <code>id_cols</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">type</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span>,</span>
<span>    values_fill <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    id_expand <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 3</span></span></span>
<span><span class="co">#&gt;   day       A     B</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Mon       5     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Tue       2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Wed       0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Thu       0     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Fri       0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Sat       0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Sun       0     0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="unused-columns">Unused columns<a class="anchor" aria-label="anchor" href="#unused-columns"></a>
</h3>
<p>Imagine you’ve found yourself in a situation where you have columns
in your data that are completely unrelated to the pivoting process, but
you’d still like to retain their information somehow. For example, in
<code>updates</code> we’d like to pivot on the <code>system</code>
column to create one row summaries of each county’s system updates.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  county <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wake"</span>, <span class="st">"Wake"</span>, <span class="st">"Wake"</span>, <span class="st">"Guilford"</span>, <span class="st">"Guilford"</span><span class="op">)</span>,</span>
<span>  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-03"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  system <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"C"</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.2</span>, <span class="fl">4</span>, <span class="fl">5.5</span>, <span class="fl">2</span>, <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">updates</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   county   date       system value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Wake     2020-01-01 A        3.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Wake     2020-01-02 B        4  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Wake     2020-01-03 C        5.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Guilford 2020-01-03 A        2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Guilford 2020-01-04 C        1.2</span></span></code></pre></div>
<p>We could do that with a typical <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> call, but
we completely lose all information about the <code>date</code>
column.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="va">county</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">system</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   county       A     B     C</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Wake       3.2     4   5.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Guilford   2      <span style="color: #BB0000;">NA</span>   1.2</span></span></code></pre></div>
<p>For this example, we’d like to retain the most recent update date
across all systems in a particular county. To accomplish that we can use
the <code>unused_fn</code> argument, which allows us to summarize values
from the columns not utilized in the pivoting process.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="va">county</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">system</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span>,</span>
<span>    unused_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">max</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   county       A     B     C date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Wake       3.2     4   5.5 2020-01-03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Guilford   2      <span style="color: #BB0000;">NA</span>   1.2 2020-01-04</span></span></code></pre></div>
<p>You can also retain the data but delay the aggregation entirely by
using <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> as the summary function.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="va">county</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">system</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span>,</span>
<span>    unused_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">list</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   county       A     B     C date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Wake       3.2     4   5.5 <span style="color: #949494;">&lt;date [3]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Guilford   2      <span style="color: #BB0000;">NA</span>   1.2 <span style="color: #949494;">&lt;date [2]&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="contact-list">Contact list<a class="anchor" aria-label="anchor" href="#contact-list"></a>
</h3>
<p>A final challenge is inspired by <a href="https://github.com/jienagu/tidyverse_examples/blob/master/example_long_wide.R" class="external-link">Jiena
Gu</a>. Imagine you have a contact list that you’ve copied and pasted
from a website:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contacts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">field</span>, <span class="op">~</span><span class="va">value</span>,</span>
<span>  <span class="st">"name"</span>, <span class="st">"Jiena McLellan"</span>,</span>
<span>  <span class="st">"company"</span>, <span class="st">"Toyota"</span>,</span>
<span>  <span class="st">"name"</span>, <span class="st">"John Smith"</span>,</span>
<span>  <span class="st">"company"</span>, <span class="st">"google"</span>,</span>
<span>  <span class="st">"email"</span>, <span class="st">"john@google.com"</span>,</span>
<span>  <span class="st">"name"</span>, <span class="st">"Huxley Ratcliffe"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This is challenging because there’s no variable that identifies which
observations belong together. We can fix this by noting that every
contact starts with a name, so we can create a unique id by counting
every time we see “name” as the <code>field</code>:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contacts</span> <span class="op">&lt;-</span> <span class="va">contacts</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    person_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">field</span> <span class="op">==</span> <span class="st">"name"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">contacts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   field   value            person_id</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> name    Jiena McLellan           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> company Toyota                   1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> name    John Smith               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> company google                   2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> email   john@google.com          2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> name    Huxley Ratcliffe         3</span></span></code></pre></div>
<p>Now that we have a unique identifier for each person, we can pivot
<code>field</code> and <code>value</code> into the columns:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contacts</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">field</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">#&gt;   person_id name             company email          </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 Jiena McLellan   Toyota  <span style="color: #BB0000;">NA</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         2 John Smith       google  john@google.com</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         3 Huxley Ratcliffe <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="longer-then-wider">Longer, then wider<a class="anchor" aria-label="anchor" href="#longer-then-wider"></a>
</h2>
<p>Some problems can’t be solved by pivoting in a single direction. The
examples in this section show how you might combine
<code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> to solve more
complex problems.</p>
<div class="section level3">
<h3 id="world-bank">World bank<a class="anchor" aria-label="anchor" href="#world-bank"></a>
</h3>
<p><code>world_bank_pop</code> contains data from the World Bank about
population per country from 2000 to 2018.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world_bank_pop</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,064 × 20</span></span></span>
<span><span class="co">#&gt;    country indicator     `2000`  `2001`  `2002`  `2003`  `2004`  `2005`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ABW     SP.URB.TOTL   4.16<span style="color: #949494;">e</span>4 4.20<span style="color: #949494;">e</span>+4 4.22<span style="color: #949494;">e</span>+4 4.23<span style="color: #949494;">e</span>+4 4.23<span style="color: #949494;">e</span>+4 4.24<span style="color: #949494;">e</span>+4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ABW     SP.URB.GROW   1.66<span style="color: #949494;">e</span>0 9.56<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 4.01<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 1.97<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 9.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span> 1.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ABW     SP.POP.TOTL   8.91<span style="color: #949494;">e</span>4 9.07<span style="color: #949494;">e</span>+4 9.18<span style="color: #949494;">e</span>+4 9.27<span style="color: #949494;">e</span>+4 9.35<span style="color: #949494;">e</span>+4 9.45<span style="color: #949494;">e</span>+4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ABW     SP.POP.GROW   2.54<span style="color: #949494;">e</span>0 1.77<span style="color: #949494;">e</span>+0 1.19<span style="color: #949494;">e</span>+0 9.97<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 9.01<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 1.00<span style="color: #949494;">e</span>+0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AFE     SP.URB.TOTL   1.16<span style="color: #949494;">e</span>8 1.20<span style="color: #949494;">e</span>+8 1.24<span style="color: #949494;">e</span>+8 1.29<span style="color: #949494;">e</span>+8 1.34<span style="color: #949494;">e</span>+8 1.39<span style="color: #949494;">e</span>+8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AFE     SP.URB.GROW   3.60<span style="color: #949494;">e</span>0 3.66<span style="color: #949494;">e</span>+0 3.72<span style="color: #949494;">e</span>+0 3.71<span style="color: #949494;">e</span>+0 3.74<span style="color: #949494;">e</span>+0 3.81<span style="color: #949494;">e</span>+0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AFE     SP.POP.TOTL   4.02<span style="color: #949494;">e</span>8 4.12<span style="color: #949494;">e</span>+8 4.23<span style="color: #949494;">e</span>+8 4.34<span style="color: #949494;">e</span>+8 4.45<span style="color: #949494;">e</span>+8 4.57<span style="color: #949494;">e</span>+8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AFE     SP.POP.GROW   2.58<span style="color: #949494;">e</span>0 2.59<span style="color: #949494;">e</span>+0 2.61<span style="color: #949494;">e</span>+0 2.62<span style="color: #949494;">e</span>+0 2.64<span style="color: #949494;">e</span>+0 2.67<span style="color: #949494;">e</span>+0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AFG     SP.URB.TOTL   4.31<span style="color: #949494;">e</span>6 4.36<span style="color: #949494;">e</span>+6 4.67<span style="color: #949494;">e</span>+6 5.06<span style="color: #949494;">e</span>+6 5.30<span style="color: #949494;">e</span>+6 5.54<span style="color: #949494;">e</span>+6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AFG     SP.URB.GROW   1.86<span style="color: #949494;">e</span>0 1.15<span style="color: #949494;">e</span>+0 6.86<span style="color: #949494;">e</span>+0 7.95<span style="color: #949494;">e</span>+0 4.59<span style="color: #949494;">e</span>+0 4.47<span style="color: #949494;">e</span>+0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,054 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more variables: `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `2017` &lt;dbl&gt;</span></span></span></code></pre></div>
<p>My goal is to produce a tidy dataset where each variable is in a
column. It’s not obvious exactly what steps are needed yet, but I’ll
start with the most obvious problem: year is spread across multiple
columns.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop2</span> <span class="op">&lt;-</span> <span class="va">world_bank_pop</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">`2000`</span><span class="op">:</span><span class="va">`2017`</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">pop2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19,152 × 4</span></span></span>
<span><span class="co">#&gt;    country indicator   year  value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ABW     SP.URB.TOTL 2000  <span style="text-decoration: underline;">41</span>625</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ABW     SP.URB.TOTL 2001  <span style="text-decoration: underline;">42</span>025</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ABW     SP.URB.TOTL 2002  <span style="text-decoration: underline;">42</span>194</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ABW     SP.URB.TOTL 2003  <span style="text-decoration: underline;">42</span>277</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ABW     SP.URB.TOTL 2004  <span style="text-decoration: underline;">42</span>317</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ABW     SP.URB.TOTL 2005  <span style="text-decoration: underline;">42</span>399</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ABW     SP.URB.TOTL 2006  <span style="text-decoration: underline;">42</span>555</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ABW     SP.URB.TOTL 2007  <span style="text-decoration: underline;">42</span>729</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ABW     SP.URB.TOTL 2008  <span style="text-decoration: underline;">42</span>906</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ABW     SP.URB.TOTL 2009  <span style="text-decoration: underline;">43</span>079</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 19,142 more rows</span></span></span></code></pre></div>
<p>Next we need to consider the <code>indicator</code> variable:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">indicator</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   indicator       n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> SP.POP.GROW  <span style="text-decoration: underline;">4</span>788</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> SP.POP.TOTL  <span style="text-decoration: underline;">4</span>788</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SP.URB.GROW  <span style="text-decoration: underline;">4</span>788</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> SP.URB.TOTL  <span style="text-decoration: underline;">4</span>788</span></span></code></pre></div>
<p>Here <code>SP.POP.GROW</code> is population growth,
<code>SP.POP.TOTL</code> is total population, and <code>SP.URB.*</code>
are the same but only for urban areas. Let’s split this up into two
variables: <code>area</code> (total or urban) and the actual variable
(population or growth):</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop3</span> <span class="op">&lt;-</span> <span class="va">pop2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/separate.html">separate</a></span><span class="op">(</span><span class="va">indicator</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"area"</span>, <span class="st">"variable"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pop3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19,152 × 5</span></span></span>
<span><span class="co">#&gt;    country area  variable year  value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ABW     URB   TOTL     2000  <span style="text-decoration: underline;">41</span>625</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ABW     URB   TOTL     2001  <span style="text-decoration: underline;">42</span>025</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ABW     URB   TOTL     2002  <span style="text-decoration: underline;">42</span>194</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ABW     URB   TOTL     2003  <span style="text-decoration: underline;">42</span>277</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ABW     URB   TOTL     2004  <span style="text-decoration: underline;">42</span>317</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ABW     URB   TOTL     2005  <span style="text-decoration: underline;">42</span>399</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ABW     URB   TOTL     2006  <span style="text-decoration: underline;">42</span>555</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ABW     URB   TOTL     2007  <span style="text-decoration: underline;">42</span>729</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ABW     URB   TOTL     2008  <span style="text-decoration: underline;">42</span>906</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ABW     URB   TOTL     2009  <span style="text-decoration: underline;">43</span>079</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 19,142 more rows</span></span></span></code></pre></div>
<p>Now we can complete the tidying by pivoting <code>variable</code> and
<code>value</code> to make <code>TOTL</code> and <code>GROW</code>
columns:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">variable</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9,576 × 5</span></span></span>
<span><span class="co">#&gt;    country area  year   TOTL   GROW</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ABW     URB   2000  <span style="text-decoration: underline;">41</span>625 1.66  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ABW     URB   2001  <span style="text-decoration: underline;">42</span>025 0.956 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ABW     URB   2002  <span style="text-decoration: underline;">42</span>194 0.401 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ABW     URB   2003  <span style="text-decoration: underline;">42</span>277 0.197 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ABW     URB   2004  <span style="text-decoration: underline;">42</span>317 0.094<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ABW     URB   2005  <span style="text-decoration: underline;">42</span>399 0.194 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ABW     URB   2006  <span style="text-decoration: underline;">42</span>555 0.367 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ABW     URB   2007  <span style="text-decoration: underline;">42</span>729 0.408 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ABW     URB   2008  <span style="text-decoration: underline;">42</span>906 0.413 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ABW     URB   2009  <span style="text-decoration: underline;">43</span>079 0.402 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9,566 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multi-choice">Multi-choice<a class="anchor" aria-label="anchor" href="#multi-choice"></a>
</h3>
<p>Based on a suggestion by <a href="https://github.com/MaximeWack" class="external-link">Maxime Wack</a>, <a href="https://github.com/tidyverse/tidyr/issues/384" class="external-link uri">https://github.com/tidyverse/tidyr/issues/384</a>), the
final example shows how to deal with a common way of recording multiple
choice data. Often you will get such data as follows:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">id</span>, <span class="op">~</span><span class="va">choice1</span>, <span class="op">~</span><span class="va">choice2</span>, <span class="op">~</span><span class="va">choice3</span>,</span>
<span>  <span class="fl">1</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>,</span>
<span>  <span class="fl">2</span>, <span class="st">"C"</span>, <span class="st">"B"</span>,  <span class="cn">NA</span>,</span>
<span>  <span class="fl">3</span>, <span class="st">"D"</span>,  <span class="cn">NA</span>,  <span class="cn">NA</span>,</span>
<span>  <span class="fl">4</span>, <span class="st">"B"</span>, <span class="st">"D"</span>,  <span class="cn">NA</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>But the actual order isn’t important, and you’d prefer to have the
individual questions in the columns. You can achieve the desired
transformation in two steps. First, you make the data longer,
eliminating the explicit <code>NA</code>s, and adding a column to
indicate that this choice was chosen:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi2</span> <span class="op">&lt;-</span> <span class="va">multi</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">!</span><span class="va">id</span>,</span>
<span>    values_drop_na <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>checked <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">multi2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;      id name    value checked</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 choice1 A     TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 choice2 B     TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 choice3 C     TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     2 choice1 C     TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     2 choice2 B     TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     3 choice1 D     TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     4 choice1 B     TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>     4 choice2 D     TRUE</span></span></code></pre></div>
<p>Then you make the data wider, filling in the missing observations
with <code>FALSE</code>:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="va">id</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">value</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">checked</span>,</span>
<span>    values_fill <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;      id A     B     C     D    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 TRUE  TRUE  TRUE  FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 FALSE TRUE  TRUE  FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 FALSE FALSE FALSE TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 FALSE TRUE  FALSE TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="manual-specs">Manual specs<a class="anchor" aria-label="anchor" href="#manual-specs"></a>
</h2>
<p>The arguments to <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and
<code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> allow you to pivot a wide range of datasets.
But the creativity that people apply to their data structures is
seemingly endless, so it’s quite possible that you will encounter a
dataset that you can’t immediately see how to reshape with
<code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code>. To gain more
control over pivoting, you can instead create a “spec” data frame that
describes exactly how data stored in the column names becomes variables
(and vice versa). This section introduces you to the spec data
structure, and show you how to use it when <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code>
and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> are insufficient.</p>
<div class="section level3">
<h3 id="longer-1">Longer<a class="anchor" aria-label="anchor" href="#longer-1"></a>
</h3>
<p>To see how this works, lets return to the simplest case of pivoting
applied to the <code>relig_income</code> dataset. Now pivoting happens
in two steps: we first create a spec object (using
<code><a href="../reference/pivot_longer_spec.html">build_longer_spec()</a></code>) then use that to describe the pivoting
operation:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="va">relig_income</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer_spec.html">build_longer_spec</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">!</span><span class="va">religion</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"income"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"count"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="../reference/pivot_longer_spec.html">pivot_longer_spec</a></span><span class="op">(</span><span class="va">relig_income</span>, <span class="va">spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 180 × 3</span></span></span>
<span><span class="co">#&gt;    religion income             count</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Agnostic &lt;$10k                 27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Agnostic $10-20k               34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Agnostic $20-30k               60</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Agnostic $30-40k               81</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Agnostic $40-50k               76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Agnostic $50-75k              137</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Agnostic $75-100k             122</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Agnostic $100-150k            109</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Agnostic &gt;150k                 84</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Agnostic Don't know/refused    96</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 170 more rows</span></span></span></code></pre></div>
<p>(This gives the same result as before, just with more code. There’s
no need to use it here, it is presented as a simple example for using
<code>spec</code>.)</p>
<p>What does <code>spec</code> look like? It’s a data frame with one row
for each column in the wide format version of the data that is not
present in the long format, and two special columns that start with
<code>.</code>:</p>
<ul>
<li>
<code>.name</code> gives the name of the column.</li>
<li>
<code>.value</code> gives the name of the column that the values in
the cells will go into.</li>
</ul>
<p>There is also one column in <code>spec</code> for each column present
in the long format of the data that is not present in the wide format of
the data. This corresponds to the <code>names_to</code> argument in
<code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_longer_spec.html">build_longer_spec()</a></code> and the
<code>names_from</code> argument in <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> and
<code><a href="../reference/pivot_wider_spec.html">build_wider_spec()</a></code>. In this example, the income column is a
character vector of the names of columns being pivoted.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 3</span></span></span>
<span><span class="co">#&gt;    .name              .value income            </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> &lt;$10k              count  &lt;$10k             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> $10-20k            count  $10-20k           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> $20-30k            count  $20-30k           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> $30-40k            count  $30-40k           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> $40-50k            count  $40-50k           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> $50-75k            count  $50-75k           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> $75-100k           count  $75-100k          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> $100-150k          count  $100-150k         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> &gt;150k              count  &gt;150k             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Don't know/refused count  Don't know/refused</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="wider-1">Wider<a class="anchor" aria-label="anchor" href="#wider-1"></a>
</h3>
<p>Below we widen <code>us_rent_income</code> with
<code><a href="../reference/pivot_wider.html">pivot_wider()</a></code>. The result is ok, but I think it could be
improved:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_rent_income</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">variable</span>,</span>
<span>    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="va">moe</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 52 × 6</span></span></span>
<span><span class="co">#&gt;    GEOID NAME         estimate_income estimate_rent moe_income moe_rent</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01    Alabama                <span style="text-decoration: underline;">24</span>476           747        136        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 02    Alaska                 <span style="text-decoration: underline;">32</span>940          <span style="text-decoration: underline;">1</span>200        508       13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 04    Arizona                <span style="text-decoration: underline;">27</span>517           972        148        4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 05    Arkansas               <span style="text-decoration: underline;">23</span>789           709        165        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 06    California             <span style="text-decoration: underline;">29</span>454          <span style="text-decoration: underline;">1</span>358        109        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 08    Colorado               <span style="text-decoration: underline;">32</span>401          <span style="text-decoration: underline;">1</span>125        109        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 09    Connecticut            <span style="text-decoration: underline;">35</span>326          <span style="text-decoration: underline;">1</span>123        195        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 10    Delaware               <span style="text-decoration: underline;">31</span>560          <span style="text-decoration: underline;">1</span>076        247       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 11    District of…           <span style="text-decoration: underline;">43</span>198          <span style="text-decoration: underline;">1</span>424        681       17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 12    Florida                <span style="text-decoration: underline;">25</span>952          <span style="text-decoration: underline;">1</span>077         70        3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 42 more rows</span></span></span></code></pre></div>
<p>I think it would be better to have columns <code>income</code>,
<code>rent</code>, <code>income_moe</code>, and <code>rent_moe</code>,
which we can achieve with a manual spec. The current spec looks like
this:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec1</span> <span class="op">&lt;-</span> <span class="va">us_rent_income</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider_spec.html">build_wider_spec</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">variable</span>,</span>
<span>    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="va">moe</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">spec1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   .name           .value   variable</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> estimate_income estimate income  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> estimate_rent   estimate rent    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> moe_income      moe      income  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> moe_rent        moe      rent</span></span></code></pre></div>
<p>For this case, we mutate <code>spec</code> to carefully construct the
column names:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec2</span> <span class="op">&lt;-</span> <span class="va">spec1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    .name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">variable</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.value</span> <span class="op">==</span> <span class="st">"moe"</span>, <span class="st">"_moe"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">spec2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   .name      .value   variable</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> income     estimate income  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> rent       estimate rent    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> income_moe moe      income  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> rent_moe   moe      rent</span></span></code></pre></div>
<p>Supplying this spec to <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> gives us the result
we’re looking for:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_rent_income</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider_spec.html">pivot_wider_spec</a></span><span class="op">(</span><span class="va">spec2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 52 × 6</span></span></span>
<span><span class="co">#&gt;    GEOID NAME                 income  rent income_moe rent_moe</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01    Alabama               <span style="text-decoration: underline;">24</span>476   747        136        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 02    Alaska                <span style="text-decoration: underline;">32</span>940  <span style="text-decoration: underline;">1</span>200        508       13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 04    Arizona               <span style="text-decoration: underline;">27</span>517   972        148        4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 05    Arkansas              <span style="text-decoration: underline;">23</span>789   709        165        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 06    California            <span style="text-decoration: underline;">29</span>454  <span style="text-decoration: underline;">1</span>358        109        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 08    Colorado              <span style="text-decoration: underline;">32</span>401  <span style="text-decoration: underline;">1</span>125        109        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 09    Connecticut           <span style="text-decoration: underline;">35</span>326  <span style="text-decoration: underline;">1</span>123        195        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 10    Delaware              <span style="text-decoration: underline;">31</span>560  <span style="text-decoration: underline;">1</span>076        247       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 11    District of Columbia  <span style="text-decoration: underline;">43</span>198  <span style="text-decoration: underline;">1</span>424        681       17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 12    Florida               <span style="text-decoration: underline;">25</span>952  <span style="text-decoration: underline;">1</span>077         70        3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 42 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="by-hand">By hand<a class="anchor" aria-label="anchor" href="#by-hand"></a>
</h3>
<p>Sometimes it’s not possible (or not convenient) to compute the spec,
and instead it’s more convenient to construct the spec “by hand”. For
example, take this <code>construction</code> data, which is lightly
modified from Table 5 “completions” found at <a href="https://www.census.gov/construction/nrc/index.html" class="external-link uri">https://www.census.gov/construction/nrc/index.html</a>:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">construction</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 9</span></span></span>
<span><span class="co">#&gt;    Year Month     `1 unit` `2 to 4 units` `5 units or more` Northeast</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>018 January        859 <span style="color: #BB0000;">NA</span>                           348       114</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>018 February       882 <span style="color: #BB0000;">NA</span>                           400       138</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>018 March          862 <span style="color: #BB0000;">NA</span>                           356       150</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>018 April          797 <span style="color: #BB0000;">NA</span>                           447       144</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>018 May            875 <span style="color: #BB0000;">NA</span>                           364        90</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>018 June           867 <span style="color: #BB0000;">NA</span>                           342        76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>  <span style="text-decoration: underline;">2</span>018 July           829 <span style="color: #BB0000;">NA</span>                           360       108</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>  <span style="text-decoration: underline;">2</span>018 August         939 <span style="color: #BB0000;">NA</span>                           286        90</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span>  <span style="text-decoration: underline;">2</span>018 September      835 <span style="color: #BB0000;">NA</span>                           304       117</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: Midwest &lt;dbl&gt;, South &lt;dbl&gt;, West &lt;dbl&gt;</span></span></span></code></pre></div>
<p>This sort of data is not uncommon from government agencies: the
column names actually belong to different variables, and here we have
summaries for number of units (1, 2-4, 5+) and regions of the country
(NE, NW, midwest, S, W). We can most easily describe that with a
tibble:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">.name</span>,            <span class="op">~</span><span class="va">.value</span>, <span class="op">~</span><span class="va">units</span>,  <span class="op">~</span><span class="va">region</span>,</span>
<span>  <span class="st">"1 unit"</span>,          <span class="st">"n"</span>,     <span class="st">"1"</span>,     <span class="cn">NA</span>,</span>
<span>  <span class="st">"2 to 4 units"</span>,    <span class="st">"n"</span>,     <span class="st">"2-4"</span>,   <span class="cn">NA</span>,</span>
<span>  <span class="st">"5 units or more"</span>, <span class="st">"n"</span>,     <span class="st">"5+"</span>,    <span class="cn">NA</span>,</span>
<span>  <span class="st">"Northeast"</span>,       <span class="st">"n"</span>,     <span class="cn">NA</span>,      <span class="st">"Northeast"</span>,</span>
<span>  <span class="st">"Midwest"</span>,         <span class="st">"n"</span>,     <span class="cn">NA</span>,      <span class="st">"Midwest"</span>,</span>
<span>  <span class="st">"South"</span>,           <span class="st">"n"</span>,     <span class="cn">NA</span>,      <span class="st">"South"</span>,</span>
<span>  <span class="st">"West"</span>,            <span class="st">"n"</span>,     <span class="cn">NA</span>,      <span class="st">"West"</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p>Which yields the following longer form:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">construction</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/pivot_longer_spec.html">pivot_longer_spec</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 63 × 5</span></span></span>
<span><span class="co">#&gt;     Year Month    units region        n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>018 January  1     <span style="color: #BB0000;">NA</span>          859</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>018 January  2-4   <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>018 January  5+    <span style="color: #BB0000;">NA</span>          348</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>018 January  <span style="color: #BB0000;">NA</span>    Northeast   114</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>018 January  <span style="color: #BB0000;">NA</span>    Midwest     169</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>018 January  <span style="color: #BB0000;">NA</span>    South       596</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>018 January  <span style="color: #BB0000;">NA</span>    West        339</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>018 February 1     <span style="color: #BB0000;">NA</span>          882</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>018 February 2-4   <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>018 February 5+    <span style="color: #BB0000;">NA</span>          400</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 53 more rows</span></span></span></code></pre></div>
<p>Note that there is no overlap between the <code>units</code> and
<code>region</code> variables; here the data would really be most
naturally described in two independent tables.</p>
</div>
<div class="section level3">
<h3 id="theory">Theory<a class="anchor" aria-label="anchor" href="#theory"></a>
</h3>
<p>One neat property of the <code>spec</code> is that you need the same
spec for <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code>.
This makes it very clear that the two operations are symmetric:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">construction</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_longer_spec.html">pivot_longer_spec</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pivot_wider_spec.html">pivot_wider_spec</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 9</span></span></span>
<span><span class="co">#&gt;    Year Month     `1 unit` `2 to 4 units` `5 units or more` Northeast</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>018 January        859             <span style="color: #BB0000;">NA</span>               348       114</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>018 February       882             <span style="color: #BB0000;">NA</span>               400       138</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>018 March          862             <span style="color: #BB0000;">NA</span>               356       150</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>018 April          797             <span style="color: #BB0000;">NA</span>               447       144</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>018 May            875             <span style="color: #BB0000;">NA</span>               364        90</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>018 June           867             <span style="color: #BB0000;">NA</span>               342        76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>  <span style="text-decoration: underline;">2</span>018 July           829             <span style="color: #BB0000;">NA</span>               360       108</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>  <span style="text-decoration: underline;">2</span>018 August         939             <span style="color: #BB0000;">NA</span>               286        90</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span>  <span style="text-decoration: underline;">2</span>018 September      835             <span style="color: #BB0000;">NA</span>               304       117</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: Midwest &lt;dbl&gt;, South &lt;dbl&gt;, West &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The pivoting spec allows us to be more precise about exactly how
<code>pivot_longer(df, spec = spec)</code> changes the shape of
<code>df</code>: it will have <code>nrow(df) * nrow(spec)</code> rows,
and <code>ncol(df) - nrow(spec) + ncol(spec) - 2</code> columns.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, Maximilian Girlich, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
