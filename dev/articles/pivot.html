<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pivoting • tidyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Pivoting">
<meta property="og:description" content="">
<meta property="og:image" content="https://tidyr.tidyverse.org/logo.png">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">tidyr</a>
        <div class="info">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.8.99.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/tidy-data.html">Tidy data</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/in-packages.html">In packages</a>
    </li>
    <li>
      <a href="../articles/nest.html">Nested data</a>
    </li>
    <li>
      <a href="../articles/pivot.html">Pivoting</a>
    </li>
    <li>
      <a href="../articles/rectangle.html">Rectangling</a>
    </li>
    <li>
      <a href="../articles/tidy-data.html">Tidy data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/02/tidyr-0-8-0/">Version 0.8.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2017/08/tidyr-0.7.0/">Version 0.7.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2016/08/15/tidyr-0-6-0/">Version 0.6.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2016/06/13/tidyr-0-5-0/">Version 0.5.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2016/02/02/tidyr-0-4-0/">Version 0.5.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2015/09/13/tidyr-0-3-0/">Version 0.4.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2014/12/08/tidyr-0-2-0/">Version 0.2.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2014/07/22/introducing-tidyr/">Version 0.1.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/tidyverse/tidyr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Pivoting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/tidyr/blob/master/vignettes/pivot.Rmd"><code>vignettes/pivot.Rmd</code></a></small>
      <div class="hidden name"><code>pivot.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette describes the use of the new <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> functions. Their goal is to improve the usability of <code><a href="../reference/gather.html">gather()</a></code> and <code><a href="../reference/spread.html">spread()</a></code>, and incorporate state-of-the-art features found in other packages.</p>
<p>For some time, it’s been obvious that there is something fundamentally wrong with the design of <code><a href="../reference/spread.html">spread()</a></code> and <code><a href="../reference/gather.html">gather()</a></code>. Many people don’t find the names intuitive and find it hard to remember which direction corresponds to spreading and which to gathering. It also seems surprisingly hard to remember the arguments to these functions, meaning that many people (including me!) have to consult the documentation every time.</p>
<p>There are two important new features inspired by other R packages that have been advancing reshaping in R:</p>
<ul>
<li><p><code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> can work with multiple value variables that may have different types, inspired by the enhanced <code>melt()</code> and <code>dcast()</code> functions provided by the <a href="https://github.com/Rdatatable/data.table/wiki">data.table</a> package by Matt Dowle and Arun Srinivasan.</p></li>
<li><p><code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> can take a data frame that specifies precisely how metadata stored in column names becomes data variables (and vice versa), inspired by the <a href="https://winvector.github.io/cdata/">cdata</a> package by John Mount and Nina Zumel.</p></li>
</ul>
<p>In this vignette, you’ll learn the key ideas behind <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> as you see them used to solve a variety of data reshaping challenges ranging from simple to complex.</p>
<p>To begin we’ll load some needed packages. In real analysis code, I’d imagine you’d do with the <code><a href="https://rdrr.io/r/base/library.html">library(tidyverse)</a></code>, but I can’t do that here since this vignette is embedded in a package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(readr)</a></code></pre></div>
</div>
<div id="longer" class="section level1">
<h1 class="hasAnchor">
<a href="#longer" class="anchor"></a>Longer</h1>
<p><code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> makes datasets <strong>longer</strong> by increasing the number of rows and decreasing the number of columns. I don’t believe it makes sense to describe a dataset as being in “long form”. Length is a relative term, and you can only say (e.g.) that dataset A is longer than dataset B.</p>
<p><code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> is commonly needed to tidy wild-caught datasets as they often optimise for ease of data entry or ease of comparison rather than ease of analysis. The following sections show how to use <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> for a wide range of realistic datasets.</p>
<div id="pew" class="section level2">
<h2 class="hasAnchor">
<a href="#pew" class="anchor"></a>String data in column names</h2>
<p>The <code>relig_income</code> dataset stores counts based on a survey which (among other things) asked people about their religion and annual income:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">relig_income</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; # A tibble: 18 x 11</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt;    religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k`</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt;  1 Agnostic      27        34        60        81        76       137</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;  2 Atheist       12        27        37        52        35        70</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;  3 Buddhist      27        21        30        34        33        58</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt;  4 Catholic     418       617       732       670       638      1116</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;  5 Don’t k…      15        14        15        11        10        35</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt;  6 Evangel…     575       869      1064       982       881      1486</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt;  7 Hindu          1         9         7         9        11        34</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt;  8 Histori…     228       244       236       238       197       223</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt;  9 Jehovah…      20        27        24        24        21        30</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; 10 Jewish        19        19        25        25        30        95</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; # … with 8 more rows, and 4 more variables: `$75-100k` &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; #   `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;, `Don't know/refused` &lt;dbl&gt;</span></a></code></pre></div>
<p>This dataset contains three variables:</p>
<ul>
<li>
<code>religion</code>, stored in the rows,</li>
<li>
<code>income</code> spread across the column names, and</li>
<li>
<code>count</code> stored in the cell values.</li>
</ul>
<p>To tidy it we use <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">relig_income <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(<span class="op">-</span>religion, <span class="dt">names_to =</span> <span class="st">"income"</span>, <span class="dt">values_to =</span> <span class="st">"count"</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; # A tibble: 180 x 3</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;    religion income             count</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;  1 Agnostic &lt;$10k                 27</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;  2 Agnostic $10-20k               34</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt;  3 Agnostic $20-30k               60</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;  4 Agnostic $30-40k               81</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt;  5 Agnostic $40-50k               76</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;  6 Agnostic $50-75k              137</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt;  7 Agnostic $75-100k             122</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt;  8 Agnostic $100-150k            109</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt;  9 Agnostic &gt;150k                 84</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; 10 Agnostic Don't know/refused    96</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt; # … with 170 more rows</span></a></code></pre></div>
<ul>
<li><p>The first argument is the dataset to reshape, <code>relig_income</code>.</p></li>
<li><p>The second argument describes which columns need to be reshaped. In this case, it’s every column apart from <code>religion</code>.</p></li>
<li><p>The <code>names_to</code> gives the name of the variable that will be created from the data stored in the column names, i.e. <code>income</code>.</p></li>
<li><p>The <code>values_to</code> gives the name of the variable that will be created from the data stored in the cell value, i.e. <code>count</code>.</p></li>
</ul>
<p>Neither the <code>names_to</code> nor the <code>values_to</code> column exists in <code>relig_income</code>, so we provide them as character strings surrounded in quotes.</p>
</div>
<div id="billboard" class="section level2">
<h2 class="hasAnchor">
<a href="#billboard" class="anchor"></a>Numeric data in column names</h2>
<p>The <code>billboard</code> dataset records the billboard rank of songs in the year 2000. It has a form similar to the <code>relig_income</code> data, but the data encoded in the column names is really a number, not a string.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">billboard</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; # A tibble: 317 x 79</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt;    artist track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;  1 2 Pac  Baby… 2000-02-26      87    82    72    77    87    94    99</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;  2 2Ge+h… The … 2000-09-02      91    87    92    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;  3 3 Doo… Kryp… 2000-04-08      81    70    68    67    66    57    54</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;  4 3 Doo… Loser 2000-10-21      76    76    72    69    67    65    55</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;  5 504 B… Wobb… 2000-04-15      57    34    25    17    17    31    36</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  6 98^0   Give… 2000-08-19      51    39    34    26    26    19     2</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  7 A*Tee… Danc… 2000-07-08      97    97    96    95   100    NA    NA</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  8 Aaliy… I Do… 2000-01-29      84    62    51    41    38    35    35</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  9 Aaliy… Try … 2000-03-18      59    53    38    28    21    18    16</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; 10 Adams… Open… 2000-08-26      76    76    74    69    68    67    61</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; # … with 307 more rows, and 69 more variables: wk8 &lt;dbl&gt;, wk9 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; #   wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; #   wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; #   wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; #   wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt; #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; #   wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; #   wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, wk49 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt; #   wk50 &lt;dbl&gt;, wk51 &lt;dbl&gt;, wk52 &lt;dbl&gt;, wk53 &lt;dbl&gt;, wk54 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt; #   wk55 &lt;dbl&gt;, wk56 &lt;dbl&gt;, wk57 &lt;dbl&gt;, wk58 &lt;dbl&gt;, wk59 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt; #   wk60 &lt;dbl&gt;, wk61 &lt;dbl&gt;, wk62 &lt;dbl&gt;, wk63 &lt;dbl&gt;, wk64 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt; #   wk65 &lt;dbl&gt;, wk66 &lt;lgl&gt;, wk67 &lt;lgl&gt;, wk68 &lt;lgl&gt;, wk69 &lt;lgl&gt;,</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt; #   wk70 &lt;lgl&gt;, wk71 &lt;lgl&gt;, wk72 &lt;lgl&gt;, wk73 &lt;lgl&gt;, wk74 &lt;lgl&gt;,</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt; #   wk75 &lt;lgl&gt;, wk76 &lt;lgl&gt;</span></a></code></pre></div>
<p>We can start with the same basic specification as for the <code>relig_income</code> dataset. Here we want the names to become a variable called <code>week</code>, and the values to become a variable called <code>rank</code>. I also use <code>values_drop_na</code> to drop rows that correspond to missing values. Not every song stays in the charts for all 76 weeks, so the structure of the input data force the creation of unnessary explicit <code>NA</code>s.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    <span class="dt">cols =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">starts_with</a></span>(<span class="st">"wk"</span>), </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="dt">names_to =</span> <span class="st">"week"</span>, </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    <span class="dt">values_to =</span> <span class="st">"rank"</span>,</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">    <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; # A tibble: 5,307 x 5</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;    artist  track                   date.entered week   rank</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt;  1 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk1      87</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;  2 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk2      82</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt;  3 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk3      72</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt;  4 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk4      77</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt;  5 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk5      87</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt;  6 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk6      94</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt;  7 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk7      99</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt;  8 2Ge+her The Hardest Part Of ... 2000-09-02   wk1      91</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt;  9 2Ge+her The Hardest Part Of ... 2000-09-02   wk2      87</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt; 10 2Ge+her The Hardest Part Of ... 2000-09-02   wk3      92</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; # … with 5,297 more rows</span></a></code></pre></div>
<p>It would be nice to easily determine how long each song stayed in the charts, but to do that, we’ll need to convert the <code>week</code> variable to an integer. We can do that by using two additional arguments: <code>names_prefix</code> strips off the <code>wk</code> prefix, and <code>names_ptypes</code> specifies that <code>week</code> should be an integer:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="dt">cols =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">starts_with</a></span>(<span class="st">"wk"</span>), </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="dt">names_to =</span> <span class="st">"week"</span>, </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="dt">names_prefix =</span> <span class="st">"wk"</span>,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">    <span class="dt">names_ptypes =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">week =</span> <span class="kw"><a href="https://rdrr.io/r/base/integer.html">integer</a></span>()),</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">    <span class="dt">values_to =</span> <span class="st">"rank"</span>,</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  )</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; # A tibble: 5,307 x 5</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt;    artist  track                   date.entered  week  rank</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;                   &lt;date&gt;       &lt;int&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt;  1 2 Pac   Baby Don't Cry (Keep... 2000-02-26       1    87</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt;  2 2 Pac   Baby Don't Cry (Keep... 2000-02-26       2    82</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt;  3 2 Pac   Baby Don't Cry (Keep... 2000-02-26       3    72</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt;  4 2 Pac   Baby Don't Cry (Keep... 2000-02-26       4    77</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt;  5 2 Pac   Baby Don't Cry (Keep... 2000-02-26       5    87</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt;  6 2 Pac   Baby Don't Cry (Keep... 2000-02-26       6    94</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt;  7 2 Pac   Baby Don't Cry (Keep... 2000-02-26       7    99</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt;  8 2Ge+her The Hardest Part Of ... 2000-09-02       1    91</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#&gt;  9 2Ge+her The Hardest Part Of ... 2000-09-02       2    87</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="co">#&gt; 10 2Ge+her The Hardest Part Of ... 2000-09-02       3    92</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co">#&gt; # … with 5,297 more rows</span></a></code></pre></div>
</div>
<div id="many-variables-in-column-names" class="section level2">
<h2 class="hasAnchor">
<a href="#many-variables-in-column-names" class="anchor"></a>Many variables in column names</h2>
<p>A more challenging situation occurs when you have multiple variables crammed into the column names. For example, take the <code>who</code> dataset:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">who</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; # A tibble: 7,240 x 60</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;    country iso2  iso3   year new_sp_m014 new_sp_m1524 new_sp_m2534</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;int&gt;       &lt;int&gt;        &lt;int&gt;        &lt;int&gt;</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;  1 Afghan… AF    AFG    1980          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;  2 Afghan… AF    AFG    1981          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  3 Afghan… AF    AFG    1982          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  4 Afghan… AF    AFG    1983          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  5 Afghan… AF    AFG    1984          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  6 Afghan… AF    AFG    1985          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  7 Afghan… AF    AFG    1986          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  8 Afghan… AF    AFG    1987          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;  9 Afghan… AF    AFG    1988          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; 10 Afghan… AF    AFG    1989          NA           NA           NA</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; # … with 7,230 more rows, and 53 more variables: new_sp_m3544 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; #   new_sp_m4554 &lt;int&gt;, new_sp_m5564 &lt;int&gt;, new_sp_m65 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; #   new_sp_f014 &lt;int&gt;, new_sp_f1524 &lt;int&gt;, new_sp_f2534 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; #   new_sp_f3544 &lt;int&gt;, new_sp_f4554 &lt;int&gt;, new_sp_f5564 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; #   new_sp_f65 &lt;int&gt;, new_sn_m014 &lt;int&gt;, new_sn_m1524 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt; #   new_sn_m2534 &lt;int&gt;, new_sn_m3544 &lt;int&gt;, new_sn_m4554 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt; #   new_sn_m5564 &lt;int&gt;, new_sn_m65 &lt;int&gt;, new_sn_f014 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt; #   new_sn_f1524 &lt;int&gt;, new_sn_f2534 &lt;int&gt;, new_sn_f3544 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt; #   new_sn_f4554 &lt;int&gt;, new_sn_f5564 &lt;int&gt;, new_sn_f65 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt; #   new_ep_m014 &lt;int&gt;, new_ep_m1524 &lt;int&gt;, new_ep_m2534 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt; #   new_ep_m3544 &lt;int&gt;, new_ep_m4554 &lt;int&gt;, new_ep_m5564 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt; #   new_ep_m65 &lt;int&gt;, new_ep_f014 &lt;int&gt;, new_ep_f1524 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt; #   new_ep_f2534 &lt;int&gt;, new_ep_f3544 &lt;int&gt;, new_ep_f4554 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-28" data-line-number="28"><span class="co">#&gt; #   new_ep_f5564 &lt;int&gt;, new_ep_f65 &lt;int&gt;, newrel_m014 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-29" data-line-number="29"><span class="co">#&gt; #   newrel_m1524 &lt;int&gt;, newrel_m2534 &lt;int&gt;, newrel_m3544 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-30" data-line-number="30"><span class="co">#&gt; #   newrel_m4554 &lt;int&gt;, newrel_m5564 &lt;int&gt;, newrel_m65 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-31" data-line-number="31"><span class="co">#&gt; #   newrel_f014 &lt;int&gt;, newrel_f1524 &lt;int&gt;, newrel_f2534 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-32" data-line-number="32"><span class="co">#&gt; #   newrel_f3544 &lt;int&gt;, newrel_f4554 &lt;int&gt;, newrel_f5564 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb7-33" data-line-number="33"><span class="co">#&gt; #   newrel_f65 &lt;int&gt;</span></a></code></pre></div>
<p><code>country</code>, <code>iso2</code>, <code>iso3</code>, and <code>year</code> are already variables, so they can be left as is. But the columns from <code>new_sp_m014</code> to <code>newrel_f65</code> encode four variables in their names:</p>
<ul>
<li><p>The <code>new_</code>/<code>new</code> prefix indicates these are counts of new cases. This dataset only contains new cases, so we’ll ignore it here because it’s constant.</p></li>
<li><p><code>sp</code>/<code>rel</code>/<code>sp</code>/<code>ep</code> describe how the case was diagnosed.</p></li>
<li><p><code>m</code>/<code>f</code> gives the gender.</p></li>
<li><p><code>014</code>/<code>1524</code>/<code>2535</code>/<code>3544</code>/<code>4554</code>/<code>65</code> supplies the age range.</p></li>
</ul>
<p>We can break these variables up by specifying multiple column names in <code>names_to</code>, and then either providing <code>names_sep</code> or <code>names_pattern</code>. Here <code>names_pattern</code> is the most natural fit. It has a similar interface to <code>extract</code>: you give it a regular expression containing groups (defined by <code>()</code>) and it puts each group in a column.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">who <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="dt">cols =</span> new_sp_m014<span class="op">:</span>newrel_f65,</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="dt">names_to =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"diagnosis"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>), </a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  <span class="dt">names_pattern =</span> <span class="st">"new_?(.*)_(.)(.*)"</span>,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="dt">values_to =</span> <span class="st">"count"</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; # A tibble: 405,440 x 8</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;    country     iso2  iso3   year diagnosis gender age   count</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;  1 Afghanistan AF    AFG    1980 sp        m      014      NA</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;  2 Afghanistan AF    AFG    1980 sp        m      1524     NA</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;  3 Afghanistan AF    AFG    1980 sp        m      2534     NA</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;  4 Afghanistan AF    AFG    1980 sp        m      3544     NA</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;  5 Afghanistan AF    AFG    1980 sp        m      4554     NA</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt;  6 Afghanistan AF    AFG    1980 sp        m      5564     NA</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt;  7 Afghanistan AF    AFG    1980 sp        m      65       NA</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;  8 Afghanistan AF    AFG    1980 sp        f      014      NA</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt;  9 Afghanistan AF    AFG    1980 sp        f      1524     NA</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; 10 Afghanistan AF    AFG    1980 sp        f      2534     NA</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt; # … with 405,430 more rows</span></a></code></pre></div>
<p>We could go one step further and specify the types of the <code>gender</code> and <code>age</code> columns. I think this is good practice when you have categorical variables with a known set of values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">who <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="dt">cols =</span> new_sp_m014<span class="op">:</span>newrel_f65,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="dt">names_to =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"diagnosis"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>), </a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="dt">names_pattern =</span> <span class="st">"new_?(.*)_(.)(.*)"</span>,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="dt">names_ptypes =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    <span class="dt">gender =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="dt">levels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"f"</span>, <span class="st">"m"</span>)),</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="dt">age =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">      <span class="dt">levels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"014"</span>, <span class="st">"1524"</span>, <span class="st">"2534"</span>, <span class="st">"3544"</span>, <span class="st">"4554"</span>, <span class="st">"5564"</span>, <span class="st">"65"</span>), </a>
<a class="sourceLine" id="cb9-9" data-line-number="9">      <span class="dt">ordered =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    )</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">  ),</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">  <span class="dt">values_to =</span> <span class="st">"count"</span>,</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt; # A tibble: 405,440 x 8</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;    country     iso2  iso3   year diagnosis gender age   count</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;     &lt;fct&gt;  &lt;ord&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt;  1 Afghanistan AF    AFG    1980 sp        m      014      NA</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt;  2 Afghanistan AF    AFG    1980 sp        m      1524     NA</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt;  3 Afghanistan AF    AFG    1980 sp        m      2534     NA</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt;  4 Afghanistan AF    AFG    1980 sp        m      3544     NA</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt;  5 Afghanistan AF    AFG    1980 sp        m      4554     NA</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt;  6 Afghanistan AF    AFG    1980 sp        m      5564     NA</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co">#&gt;  7 Afghanistan AF    AFG    1980 sp        m      65       NA</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="co">#&gt;  8 Afghanistan AF    AFG    1980 sp        f      014      NA</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="co">#&gt;  9 Afghanistan AF    AFG    1980 sp        f      1524     NA</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="co">#&gt; 10 Afghanistan AF    AFG    1980 sp        f      2534     NA</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="co">#&gt; # … with 405,430 more rows</span></a></code></pre></div>
</div>
<div id="multiple-observations-per-row" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-observations-per-row" class="anchor"></a>Multiple observations per row</h2>
<p>So far, we have been working with data frames that have one observation per row, but many important pivotting problems involve multiple observations per row. You can usually recognise this case because name of the column that you want to appear in the output is part of the column name in the input. In this section, you’ll learn how to pivot this sort of data.</p>
<p>The following example is adapted from the <a href="https://CRAN.R-project.org/package=data.table/vignettes/datatable-reshape.html">data.table vignette</a>, as inspiration for tidyr’s solution to this problem.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">family &lt;-<span class="st"> </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="op">~</span>family,  <span class="op">~</span>dob_child1,  <span class="op">~</span>dob_child2, <span class="op">~</span>gender_child1, <span class="op">~</span>gender_child2,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">       1L, <span class="st">"1998-11-26"</span>, <span class="st">"2000-01-29"</span>,             1L,             2L,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">       2L, <span class="st">"1996-06-22"</span>,           <span class="ot">NA</span>,             2L,             <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">       3L, <span class="st">"2002-07-11"</span>, <span class="st">"2004-04-05"</span>,             2L,             2L,</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">       4L, <span class="st">"2004-10-10"</span>, <span class="st">"2009-08-27"</span>,             1L,             1L,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">       5L, <span class="st">"2000-12-05"</span>, <span class="st">"2005-02-28"</span>,             2L,             1L,</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">family &lt;-<span class="st"> </span>family <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">starts_with</a></span>(<span class="st">"dob"</span>)), parse_date)</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">family</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; # A tibble: 5 x 5</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;   family dob_child1 dob_child2 gender_child1 gender_child2</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;    &lt;int&gt; &lt;date&gt;     &lt;date&gt;             &lt;int&gt;         &lt;int&gt;</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; 1      1 1998-11-26 2000-01-29             1             2</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; 2      2 1996-06-22 NA                     2            NA</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; 3      3 2002-07-11 2004-04-05             2             2</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; 4      4 2004-10-10 2009-08-27             1             1</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; 5      5 2000-12-05 2005-02-28             2             1</span></a></code></pre></div>
<p>Note that we have two pieces of information (or values) for each child: their <code>gender</code> and their <code>dob</code> (date of birth). These need to go into separate columns in the result. Again we supply multiple variables to <code>names_to</code>, using <code>names_sep</code> to split up each variable name. Note the special name <code>.value</code>: this tells <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> that that part of the column name specifies the “value” being measured (which will become a variable in the output).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">family <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">    <span class="op">-</span>family, </a>
<a class="sourceLine" id="cb11-4" data-line-number="4">    <span class="dt">names_to =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">".value"</span>, <span class="st">"child"</span>), </a>
<a class="sourceLine" id="cb11-5" data-line-number="5">    <span class="dt">names_sep =</span> <span class="st">"_"</span>, </a>
<a class="sourceLine" id="cb11-6" data-line-number="6">    <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; # A tibble: 9 x 4</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;   family child  dob        gender</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;  &lt;date&gt;      &lt;int&gt;</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; 1      1 child1 1998-11-26      1</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; 2      1 child2 2000-01-29      2</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; 3      2 child1 1996-06-22      2</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; 4      3 child1 2002-07-11      2</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; 5      3 child2 2004-04-05      2</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; 6      4 child1 2004-10-10      1</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt; 7      4 child2 2009-08-27      1</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; 8      5 child1 2000-12-05      2</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; 9      5 child2 2005-02-28      1</span></a></code></pre></div>
<p>Note the use of <code>values_drop_na = TRUE</code>: the input shape forces the creation of explicit missing variables for observations that don’t exist.</p>
<p>This problem also exists in the <code>anscombe</code> dataset built in to base R:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">anscombe</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt;    x1 x2 x3 x4    y1   y2    y3    y4</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt; 1  10 10 10  8  8.04 9.14  7.46  6.58</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; 2   8  8  8  8  6.95 8.14  6.77  5.76</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; 3  13 13 13  8  7.58 8.74 12.74  7.71</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; 4   9  9  9  8  8.81 8.77  7.11  8.84</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; 5  11 11 11  8  8.33 9.26  7.81  8.47</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; 6  14 14 14  8  9.96 8.10  8.84  7.04</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; 7   6  6  6  8  7.24 6.13  6.08  5.25</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; 8   4  4  4 19  4.26 3.10  5.39 12.50</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; 9  12 12 12  8 10.84 9.13  8.15  5.56</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt; 10  7  7  7  8  4.82 7.26  6.42  7.91</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt; 11  5  5  5  8  5.68 4.74  5.73  6.89</span></a></code></pre></div>
<p>This dataset contains four pairs of variables (<code>x1</code> and <code>y1</code>, <code>x2</code> and <code>y2</code>, etc) that underlie Anscombe’s quartet, a collection of four datasets that have the same summary statistics (mean, sd, correlation etc), but have quite different data. We want to produce a dataset with columns <code>set</code>, <code>x</code> and <code>y</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">anscombe <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">everything</a></span>(), </a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    <span class="dt">names_to =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">".value"</span>, <span class="st">"set"</span>), </a>
<a class="sourceLine" id="cb13-4" data-line-number="4">    <span class="dt">names_pattern =</span> <span class="st">"(.)(.)"</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(set)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; # A tibble: 44 x 3</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt;    set       x     y</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt;  1 1        10  8.04</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt;  2 1         8  6.95</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt;  3 1        13  7.58</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt;  4 1         9  8.81</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt;  5 1        11  8.33</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt;  6 1        14  9.96</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt;  7 1         6  7.24</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt;  8 1         4  4.26</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt;  9 1        12 10.8 </span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt; 10 1         7  4.82</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">#&gt; # … with 34 more rows</span></a></code></pre></div>
<p>A similar situation can arise with panel data. For example, take this example dataset provided by <a href="http://github.com/leeper/rio/issues/193">Thomas Leeper</a>. We can tidy it using the same approach as for <code>anscombe</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">pnl &lt;-<span class="st"> </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  <span class="dt">a =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  <span class="dt">b =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">  <span class="dt">y1 =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">  <span class="dt">y2 =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">4</span>),</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">  <span class="dt">z1 =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">3</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">  <span class="dt">z2 =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"></a>
<a class="sourceLine" id="cb14-11" data-line-number="11">pnl <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">    <span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(x, a, b), </a>
<a class="sourceLine" id="cb14-14" data-line-number="14">    <span class="dt">names_to =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">".value"</span>, <span class="st">"time"</span>), </a>
<a class="sourceLine" id="cb14-15" data-line-number="15">    <span class="dt">names_pattern =</span> <span class="st">"(.)(.)"</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt; # A tibble: 8 x 6</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt;       x     a     b time       y     z</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">#&gt; 1     1     1     0 1     -0.458     3</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">#&gt; 2     1     1     0 2     -0.574    -2</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="co">#&gt; 3     2     1     1 1     -1.12      3</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="co">#&gt; 4     2     1     1 2      1.08     -2</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24"><span class="co">#&gt; 5     3     0     1 1      1.81      3</span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25"><span class="co">#&gt; 6     3     0     1 2      0.248    -2</span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"><span class="co">#&gt; 7     4     0     1 1     -1.42      3</span></a>
<a class="sourceLine" id="cb14-27" data-line-number="27"><span class="co">#&gt; 8     4     0     1 2     -0.545    -2</span></a></code></pre></div>
</div>
<div id="duplicated-column-names" class="section level2">
<h2 class="hasAnchor">
<a href="#duplicated-column-names" class="anchor"></a>Duplicated column names</h2>
<p>Occassionally you will come across datasets that have duplicated column names. Generally, such datasets are hard to work with in R, because when you refer to a column by name it only finds the first match. To create a tibble with duplicated names, you have to explicitly opt out of the name repair that usually prevents you from creating such a dataset:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">y =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">y =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">.name_repair =</span> <span class="st">"minimal"</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">df</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 4</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#&gt;       x     y     y     y</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co">#&gt; 1     1     4     5     7</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">#&gt; 2     2     5     6     8</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">#&gt; 3     3     6     7     9</span></a></code></pre></div>
<p>When <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> encounters such data, it automatically adds another column to the output:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(<span class="op">-</span>x, <span class="dt">names_to =</span> <span class="st">"name"</span>, <span class="dt">values_to =</span> <span class="st">"value"</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">#&gt; Warning: Duplicate column names detected, adding .copy variable</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt; # A tibble: 9 x 4</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt;       x name  .copy value</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt; 1     1 y         1     4</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt; 2     1 y         2     5</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt; 3     1 y         3     7</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; 4     2 y         1     5</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt; 5     2 y         2     6</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt; 6     2 y         3     8</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt; 7     3 y         1     6</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt; 8     3 y         2     7</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt; 9     3 y         3     9</span></a></code></pre></div>
</div>
</div>
<div id="wider" class="section level1">
<h1 class="hasAnchor">
<a href="#wider" class="anchor"></a>Wider</h1>
<p><code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> is the opposite of <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code>: it makes a dataset <strong>wider</strong> by increasing the number of columns and decreasing the number of rows. It’s relatively rare to need <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> to make tidy data, but it’s often useful for creating summary tables for presentation, or data in a format needed by other tools.</p>
<div id="capture-recapture-data" class="section level2">
<h2 class="hasAnchor">
<a href="#capture-recapture-data" class="anchor"></a>Capture-recapture data</h2>
<p>The <code>fish_encounters</code> dataset, contributed by <a href="https://fishsciences.github.io/post/visualizing-fish-encounter-histories/">Myfanwy Johnston</a>, describes when fish swimming down a river are detected by automatic monitoring stations:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">fish_encounters</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">#&gt; # A tibble: 114 x 3</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#&gt;    fish  station  seen</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">#&gt;    &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#&gt;  1 4842  Release     1</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt;  2 4842  I80_1       1</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">#&gt;  3 4842  Lisbon      1</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt;  4 4842  Rstr        1</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt;  5 4842  Base_TD     1</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt;  6 4842  BCE         1</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt;  7 4842  BCW         1</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt;  8 4842  BCE2        1</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt;  9 4842  BCW2        1</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt; 10 4842  MAE         1</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt; # … with 104 more rows</span></a></code></pre></div>
<p>Many tools used to analyse this data need it in a form where each station is a column:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">fish_encounters <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(<span class="dt">names_from =</span> station, <span class="dt">values_from =</span> seen)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co">#&gt; # A tibble: 19 x 12</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#&gt;    fish  Release I80_1 Lisbon  Rstr Base_TD   BCE   BCW  BCE2  BCW2   MAE</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">#&gt;    &lt;fct&gt;   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#&gt;  1 4842        1     1      1     1       1     1     1     1     1     1</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt;  2 4843        1     1      1     1       1     1     1     1     1     1</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt;  3 4844        1     1      1     1       1     1     1     1     1     1</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt;  4 4845        1     1      1     1       1    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt;  5 4847        1     1      1    NA      NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt;  6 4848        1     1      1     1      NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt;  7 4849        1     1     NA    NA      NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt;  8 4850        1     1     NA     1       1     1     1    NA    NA    NA</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">#&gt;  9 4851        1     1     NA    NA      NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#&gt; 10 4854        1     1     NA    NA      NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">#&gt; # … with 9 more rows, and 1 more variable: MAW &lt;int&gt;</span></a></code></pre></div>
<p>This dataset only records when a fish was detected by the station - it doesn’t record when it wasn’t detected (this is common with this type of data). That means the output data is filled with <code>NA</code>s. However, in this case we know that the absence of a record means that the fish was not <code>seen</code>, so we can ask <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> to fill these missing values in with zeros:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">fish_encounters <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">  <span class="dt">names_from =</span> station, </a>
<a class="sourceLine" id="cb19-3" data-line-number="3">  <span class="dt">values_from =</span> seen,</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">  <span class="dt">values_fill =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">seen =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt; # A tibble: 19 x 12</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt;    fish  Release I80_1 Lisbon  Rstr Base_TD   BCE   BCW  BCE2  BCW2   MAE</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt;    &lt;fct&gt;   &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt;  1 4842        1     1      1     1       1     1     1     1     1     1</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co">#&gt;  2 4843        1     1      1     1       1     1     1     1     1     1</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co">#&gt;  3 4844        1     1      1     1       1     1     1     1     1     1</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co">#&gt;  4 4845        1     1      1     1       1     0     0     0     0     0</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="co">#&gt;  5 4847        1     1      1     0       0     0     0     0     0     0</span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">#&gt;  6 4848        1     1      1     1       0     0     0     0     0     0</span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="co">#&gt;  7 4849        1     1      0     0       0     0     0     0     0     0</span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">#&gt;  8 4850        1     1      0     1       1     1     1     0     0     0</span></a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="co">#&gt;  9 4851        1     1      0     0       0     0     0     0     0     0</span></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">#&gt; 10 4854        1     1      0     0       0     0     0     0     0     0</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="co">#&gt; # … with 9 more rows, and 1 more variable: MAW &lt;int&gt;</span></a></code></pre></div>
</div>
<div id="aggregation" class="section level2">
<h2 class="hasAnchor">
<a href="#aggregation" class="anchor"></a>Aggregation</h2>
<p>You can also use <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> to perform simple aggregation. For example, take the <code>warpbreaks</code> dataset built in to base R (converted to a tibble for the better print method):</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">warpbreaks &lt;-<span class="st"> </span>warpbreaks <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(wool, tension, breaks)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">warpbreaks</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="co">#&gt; # A tibble: 54 x 3</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">#&gt;    wool  tension breaks</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co">#&gt;    &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt;  1 A     L           26</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt;  2 A     L           30</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt;  3 A     L           54</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt;  4 A     L           25</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt;  5 A     L           70</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">#&gt;  6 A     L           52</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">#&gt;  7 A     L           51</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt;  8 A     L           26</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt;  9 A     L           67</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt; 10 A     M           18</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">#&gt; # … with 44 more rows</span></a></code></pre></div>
<p>This is a designed experiment with nine replicates for every combination of <code>wool</code> (<code>A</code> and <code>B</code>) and <code>tension</code> (<code>L</code>, <code>M</code>, <code>H</code>):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">warpbreaks <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(wool, tension)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="co">#&gt;   wool  tension     n</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co">#&gt;   &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="co">#&gt; 1 A     L           9</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="co">#&gt; 2 A     M           9</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co">#&gt; 3 A     H           9</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co">#&gt; 4 B     L           9</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="co">#&gt; 5 B     M           9</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co">#&gt; 6 B     H           9</span></a></code></pre></div>
<p>What happens if we attempt to pivot the levels of <code>wool</code> into the columns?</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">warpbreaks <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(<span class="dt">names_from =</span> wool, <span class="dt">values_from =</span> breaks)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co">#&gt; Warning: Values in `breaks` are not uniquely identified; output will contain list-cols.</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="co">#&gt; * Use `values_fn = list(breaks = list)` to suppress this warning.</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co">#&gt; * Use `values_fn = list(breaks = length)` to identify where the duplicates arise</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co">#&gt; * Use `values_fn = list(breaks = summary_fun)` to summarise duplicates</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co">#&gt;   tension           A           B</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">#&gt;   &lt;fct&gt;   &lt;list&lt;dbl&gt;&gt; &lt;list&lt;dbl&gt;&gt;</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="co">#&gt; 1 L               [9]         [9]</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co">#&gt; 2 M               [9]         [9]</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co">#&gt; 3 H               [9]         [9]</span></a></code></pre></div>
<p>We get a warning that each cell in the output corresponds to multiple cells in the input. The default behaviour produces list-columns, which contain all the individual values. A more useful output would be summary statistics, e.g. <code>mean</code> breaks for each combination of wool and tension:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">warpbreaks <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">    <span class="dt">names_from =</span> wool, </a>
<a class="sourceLine" id="cb23-4" data-line-number="4">    <span class="dt">values_from =</span> breaks,</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">    <span class="dt">values_fn =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">breaks =</span> mean)</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="co">#&gt;   tension     A     B</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"><span class="co">#&gt;   &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="co">#&gt; 1 L        44.6  28.2</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="co">#&gt; 2 M        24    28.8</span></a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="co">#&gt; 3 H        24.6  18.8</span></a></code></pre></div>
<p>For more complex summary operations, I recommend summarising before reshaping, but for simple cases it’s often convenient to summarise within <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code>.</p>
</div>
<div id="generate-column-name-from-multiple-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#generate-column-name-from-multiple-variables" class="anchor"></a>Generate column name from multiple variables</h2>
<p>Imagine, as in <a href="http://stackoverflow.com/questions/24929954" class="uri">http://stackoverflow.com/questions/24929954</a>, that we have information containing the combination of product, country, and year. In tidy form it might look like this:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">production &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand_grid.html">expand_grid</a></span>(</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">    <span class="dt">product =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>, <span class="st">"B"</span>), </a>
<a class="sourceLine" id="cb24-3" data-line-number="3">    <span class="dt">country =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AI"</span>, <span class="st">"EI"</span>), </a>
<a class="sourceLine" id="cb24-4" data-line-number="4">    <span class="dt">year =</span> <span class="dv">2000</span><span class="op">:</span><span class="dv">2014</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>((product <span class="op">==</span><span class="st"> "A"</span> <span class="op">&amp;</span><span class="st"> </span>country <span class="op">==</span><span class="st"> "AI"</span>) <span class="op">|</span><span class="st"> </span>product <span class="op">==</span><span class="st"> "B"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">production =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)))</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">production</a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="co">#&gt; # A tibble: 45 x 4</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="co">#&gt;    product country  year production</span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb24-12" data-line-number="12"><span class="co">#&gt;  1 A       AI       2000     0.191 </span></a>
<a class="sourceLine" id="cb24-13" data-line-number="13"><span class="co">#&gt;  2 A       AI       2001    -1.54  </span></a>
<a class="sourceLine" id="cb24-14" data-line-number="14"><span class="co">#&gt;  3 A       AI       2002     0.904 </span></a>
<a class="sourceLine" id="cb24-15" data-line-number="15"><span class="co">#&gt;  4 A       AI       2003     0.0883</span></a>
<a class="sourceLine" id="cb24-16" data-line-number="16"><span class="co">#&gt;  5 A       AI       2004     0.437 </span></a>
<a class="sourceLine" id="cb24-17" data-line-number="17"><span class="co">#&gt;  6 A       AI       2005     0.0804</span></a>
<a class="sourceLine" id="cb24-18" data-line-number="18"><span class="co">#&gt;  7 A       AI       2006     0.951 </span></a>
<a class="sourceLine" id="cb24-19" data-line-number="19"><span class="co">#&gt;  8 A       AI       2007     1.14  </span></a>
<a class="sourceLine" id="cb24-20" data-line-number="20"><span class="co">#&gt;  9 A       AI       2008     0.158 </span></a>
<a class="sourceLine" id="cb24-21" data-line-number="21"><span class="co">#&gt; 10 A       AI       2009     1.31  </span></a>
<a class="sourceLine" id="cb24-22" data-line-number="22"><span class="co">#&gt; # … with 35 more rows</span></a></code></pre></div>
<p>We want to widen the data so we have one column for each combination of <code>product</code> and <code>country</code>. The key is to specify multiple variables for <code>names_from</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">production <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">  <span class="dt">names_from =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(product, country), </a>
<a class="sourceLine" id="cb25-3" data-line-number="3">  <span class="dt">values_from =</span> production</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="co">#&gt; # A tibble: 15 x 4</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="co">#&gt;     year    A_AI    B_AI   B_EI</span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="co">#&gt;    &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="co">#&gt;  1  2000  0.191   0.671   1.89 </span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="co">#&gt;  2  2001 -1.54   -0.525   0.833</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="co">#&gt;  3  2002  0.904   1.44    1.32 </span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11"><span class="co">#&gt;  4  2003  0.0883 -1.22   -0.201</span></a>
<a class="sourceLine" id="cb25-12" data-line-number="12"><span class="co">#&gt;  5  2004  0.437   1.13   -0.359</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13"><span class="co">#&gt;  6  2005  0.0804  0.277  -1.83 </span></a>
<a class="sourceLine" id="cb25-14" data-line-number="14"><span class="co">#&gt;  7  2006  0.951  -0.0211  1.94 </span></a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="co">#&gt;  8  2007  1.14    1.10    2.11 </span></a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="co">#&gt;  9  2008  0.158  -0.720   1.50 </span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17"><span class="co">#&gt; 10  2009  1.31    1.02   -0.393</span></a>
<a class="sourceLine" id="cb25-18" data-line-number="18"><span class="co">#&gt; # … with 5 more rows</span></a></code></pre></div>
</div>
<div id="tidy-census" class="section level2">
<h2 class="hasAnchor">
<a href="#tidy-census" class="anchor"></a>Tidy census</h2>
<p>The <code>us_rent_income</code> dataset contains information about median income and rent for each state in the US for 2017 (from the American Community Survey, retrieved with the <a href="https://walkerke.github.io/tidycensus">tidycensus</a> package).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">us_rent_income</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co">#&gt; # A tibble: 104 x 5</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="co">#&gt;    GEOID NAME       variable estimate   moe</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co">#&gt;  1 01    Alabama    income      24476   136</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="co">#&gt;  2 01    Alabama    rent          747     3</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="co">#&gt;  3 02    Alaska     income      32940   508</span></a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="co">#&gt;  4 02    Alaska     rent         1200    13</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="co">#&gt;  5 04    Arizona    income      27517   148</span></a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="co">#&gt;  6 04    Arizona    rent          972     4</span></a>
<a class="sourceLine" id="cb26-11" data-line-number="11"><span class="co">#&gt;  7 05    Arkansas   income      23789   165</span></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"><span class="co">#&gt;  8 05    Arkansas   rent          709     5</span></a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="co">#&gt;  9 06    California income      29454   109</span></a>
<a class="sourceLine" id="cb26-14" data-line-number="14"><span class="co">#&gt; 10 06    California rent         1358     3</span></a>
<a class="sourceLine" id="cb26-15" data-line-number="15"><span class="co">#&gt; # … with 94 more rows</span></a></code></pre></div>
<p>Here both <code>estimate</code> and <code>moe</code> are values columns, so we can supply them to <code>values_from</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">us_rent_income <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(<span class="dt">names_from =</span> variable, <span class="dt">values_from =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(estimate, moe))</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="co">#&gt; # A tibble: 52 x 6</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#&gt;    GEOID NAME             estimate_income estimate_rent moe_income moe_rent</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                      &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">#&gt;  1 01    Alabama                    24476           747        136        3</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#&gt;  2 02    Alaska                     32940          1200        508       13</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="co">#&gt;  3 04    Arizona                    27517           972        148        4</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="co">#&gt;  4 05    Arkansas                   23789           709        165        5</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#&gt;  5 06    California                 29454          1358        109        3</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="co">#&gt;  6 08    Colorado                   32401          1125        109        5</span></a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="co">#&gt;  7 09    Connecticut                35326          1123        195        5</span></a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="co">#&gt;  8 10    Delaware                   31560          1076        247       10</span></a>
<a class="sourceLine" id="cb27-14" data-line-number="14"><span class="co">#&gt;  9 11    District of Col…           43198          1424        681       17</span></a>
<a class="sourceLine" id="cb27-15" data-line-number="15"><span class="co">#&gt; 10 12    Florida                    25952          1077         70        3</span></a>
<a class="sourceLine" id="cb27-16" data-line-number="16"><span class="co">#&gt; # … with 42 more rows</span></a></code></pre></div>
<p>Note that the name of the variable is automatically appended to the output columns.</p>
</div>
<div id="contact-list" class="section level2">
<h2 class="hasAnchor">
<a href="#contact-list" class="anchor"></a>Contact list</h2>
<p>A final challenge is inspired by <a href="https://github.com/jienagu/tidyverse_examples/blob/master/example_long_wide.R">Jiena Gu</a>. Imagine you have a contact list that you’ve copied and pasted from a website:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">contacts &lt;-<span class="st"> </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">  <span class="op">~</span>field, <span class="op">~</span>value,</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">  <span class="st">"name"</span>, <span class="st">"Jiena McLellan"</span>,</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">  <span class="st">"company"</span>, <span class="st">"Toyota"</span>, </a>
<a class="sourceLine" id="cb28-5" data-line-number="5">  <span class="st">"name"</span>, <span class="st">"John Smith"</span>, </a>
<a class="sourceLine" id="cb28-6" data-line-number="6">  <span class="st">"company"</span>, <span class="st">"google"</span>, </a>
<a class="sourceLine" id="cb28-7" data-line-number="7">  <span class="st">"email"</span>, <span class="st">"john@google.com"</span>,</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">  <span class="st">"name"</span>, <span class="st">"Huxley Ratcliffe"</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9">)</a></code></pre></div>
<p>This is challenging because there’s no variable that identifies which observations belong together. We can fix this by noting that every contact starts with a name, so we can create a unique id by counting every time we see “name” as the <code>field</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">contacts &lt;-<span class="st"> </span>contacts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">    <span class="dt">person_id =</span> <span class="kw"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(field <span class="op">==</span><span class="st"> "name"</span>)</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">contacts</a>
<a class="sourceLine" id="cb29-6" data-line-number="6"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb29-7" data-line-number="7"><span class="co">#&gt;   field   value            person_id</span></a>
<a class="sourceLine" id="cb29-8" data-line-number="8"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;                &lt;int&gt;</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9"><span class="co">#&gt; 1 name    Jiena McLellan           1</span></a>
<a class="sourceLine" id="cb29-10" data-line-number="10"><span class="co">#&gt; 2 company Toyota                   1</span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11"><span class="co">#&gt; 3 name    John Smith               2</span></a>
<a class="sourceLine" id="cb29-12" data-line-number="12"><span class="co">#&gt; 4 company google                   2</span></a>
<a class="sourceLine" id="cb29-13" data-line-number="13"><span class="co">#&gt; 5 email   john@google.com          2</span></a>
<a class="sourceLine" id="cb29-14" data-line-number="14"><span class="co">#&gt; 6 name    Huxley Ratcliffe         3</span></a></code></pre></div>
<p>Now that we have a unique identifier for each person, we can pivot <code>field</code> and <code>value</code> into the columns:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">contacts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(<span class="dt">names_from =</span> field, <span class="dt">values_from =</span> value)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 4</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="co">#&gt;   person_id name             company email          </span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt;          </span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="co">#&gt; 1         1 Jiena McLellan   Toyota  &lt;NA&gt;           </span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7"><span class="co">#&gt; 2         2 John Smith       google  john@google.com</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="co">#&gt; 3         3 Huxley Ratcliffe &lt;NA&gt;    &lt;NA&gt;</span></a></code></pre></div>
</div>
</div>
<div id="longer-then-wider" class="section level1">
<h1 class="hasAnchor">
<a href="#longer-then-wider" class="anchor"></a>Longer, then wider</h1>
<p>Some problems can’t be solved by pivotting in a single direction. The examples in this section show how you might combine <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> to solve more complex problems.</p>
<div id="world-bank" class="section level2">
<h2 class="hasAnchor">
<a href="#world-bank" class="anchor"></a>World bank</h2>
<p><code>world_bank_pop</code> contains data from the World Bank about population per country from 2000 to 2018.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">world_bank_pop</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="co">#&gt; # A tibble: 1,056 x 20</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="co">#&gt;    country indicator `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="co">#&gt;  1 ABW     SP.URB.T… 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="co">#&gt;  2 ABW     SP.URB.G… 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2</span></a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="co">#&gt;  3 ABW     SP.POP.T… 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8"><span class="co">#&gt;  4 ABW     SP.POP.G… 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1</span></a>
<a class="sourceLine" id="cb31-9" data-line-number="9"><span class="co">#&gt;  5 AFG     SP.URB.T… 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6</span></a>
<a class="sourceLine" id="cb31-10" data-line-number="10"><span class="co">#&gt;  6 AFG     SP.URB.G… 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0</span></a>
<a class="sourceLine" id="cb31-11" data-line-number="11"><span class="co">#&gt;  7 AFG     SP.POP.T… 2.01e7 2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7</span></a>
<a class="sourceLine" id="cb31-12" data-line-number="12"><span class="co">#&gt;  8 AFG     SP.POP.G… 3.49e0 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0</span></a>
<a class="sourceLine" id="cb31-13" data-line-number="13"><span class="co">#&gt;  9 AGO     SP.URB.T… 8.23e6 8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7</span></a>
<a class="sourceLine" id="cb31-14" data-line-number="14"><span class="co">#&gt; 10 AGO     SP.URB.G… 5.44e0 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0</span></a>
<a class="sourceLine" id="cb31-15" data-line-number="15"><span class="co">#&gt; # … with 1,046 more rows, and 11 more variables: `2007` &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb31-16" data-line-number="16"><span class="co">#&gt; #   `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb31-17" data-line-number="17"><span class="co">#&gt; #   `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</span></a></code></pre></div>
<p>My goal is to produce a tidy dataset where each variable is in a column. It’s not obvious exactly what steps are needed yet, but I’ll start with the most obvious problem: year is spread across multiple columns.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">pop2 &lt;-<span class="st"> </span>world_bank_pop <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(<span class="st">`</span><span class="dt">2000</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2017</span><span class="st">`</span>, <span class="dt">names_to =</span> <span class="st">"year"</span>, <span class="dt">values_to =</span> <span class="st">"value"</span>)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">pop2</a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="co">#&gt; # A tibble: 19,008 x 4</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="co">#&gt;    country indicator   year  value</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="co">#&gt;  1 ABW     SP.URB.TOTL 2000  42444</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8"><span class="co">#&gt;  2 ABW     SP.URB.TOTL 2001  43048</span></a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="co">#&gt;  3 ABW     SP.URB.TOTL 2002  43670</span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="co">#&gt;  4 ABW     SP.URB.TOTL 2003  44246</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="co">#&gt;  5 ABW     SP.URB.TOTL 2004  44669</span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="co">#&gt;  6 ABW     SP.URB.TOTL 2005  44889</span></a>
<a class="sourceLine" id="cb32-13" data-line-number="13"><span class="co">#&gt;  7 ABW     SP.URB.TOTL 2006  44881</span></a>
<a class="sourceLine" id="cb32-14" data-line-number="14"><span class="co">#&gt;  8 ABW     SP.URB.TOTL 2007  44686</span></a>
<a class="sourceLine" id="cb32-15" data-line-number="15"><span class="co">#&gt;  9 ABW     SP.URB.TOTL 2008  44375</span></a>
<a class="sourceLine" id="cb32-16" data-line-number="16"><span class="co">#&gt; 10 ABW     SP.URB.TOTL 2009  44052</span></a>
<a class="sourceLine" id="cb32-17" data-line-number="17"><span class="co">#&gt; # … with 18,998 more rows</span></a></code></pre></div>
<p>Next we need to consider the <code>indicator</code> variable:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">pop2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(indicator)</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="co">#&gt; # A tibble: 4 x 2</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="co">#&gt;   indicator       n</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="co">#&gt; 1 SP.POP.GROW  4752</span></a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="co">#&gt; 2 SP.POP.TOTL  4752</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7"><span class="co">#&gt; 3 SP.URB.GROW  4752</span></a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="co">#&gt; 4 SP.URB.TOTL  4752</span></a></code></pre></div>
<p>Here <code>SP.POP.GROW</code> is population growth, <code>SP.POP.TOTL</code> is total population, and <code>SP.URB.*</code> are the same but only for urban areas. Let’s split this up into two variables: <code>area</code> (total or urban) and the actual variable (population or growth):</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">pop3 &lt;-<span class="st"> </span>pop2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/separate.html">separate</a></span>(indicator, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="ot">NA</span>, <span class="st">"area"</span>, <span class="st">"variable"</span>))</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">pop3</a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="co">#&gt; # A tibble: 19,008 x 5</span></a>
<a class="sourceLine" id="cb34-5" data-line-number="5"><span class="co">#&gt;    country area  variable year  value</span></a>
<a class="sourceLine" id="cb34-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb34-7" data-line-number="7"><span class="co">#&gt;  1 ABW     URB   TOTL     2000  42444</span></a>
<a class="sourceLine" id="cb34-8" data-line-number="8"><span class="co">#&gt;  2 ABW     URB   TOTL     2001  43048</span></a>
<a class="sourceLine" id="cb34-9" data-line-number="9"><span class="co">#&gt;  3 ABW     URB   TOTL     2002  43670</span></a>
<a class="sourceLine" id="cb34-10" data-line-number="10"><span class="co">#&gt;  4 ABW     URB   TOTL     2003  44246</span></a>
<a class="sourceLine" id="cb34-11" data-line-number="11"><span class="co">#&gt;  5 ABW     URB   TOTL     2004  44669</span></a>
<a class="sourceLine" id="cb34-12" data-line-number="12"><span class="co">#&gt;  6 ABW     URB   TOTL     2005  44889</span></a>
<a class="sourceLine" id="cb34-13" data-line-number="13"><span class="co">#&gt;  7 ABW     URB   TOTL     2006  44881</span></a>
<a class="sourceLine" id="cb34-14" data-line-number="14"><span class="co">#&gt;  8 ABW     URB   TOTL     2007  44686</span></a>
<a class="sourceLine" id="cb34-15" data-line-number="15"><span class="co">#&gt;  9 ABW     URB   TOTL     2008  44375</span></a>
<a class="sourceLine" id="cb34-16" data-line-number="16"><span class="co">#&gt; 10 ABW     URB   TOTL     2009  44052</span></a>
<a class="sourceLine" id="cb34-17" data-line-number="17"><span class="co">#&gt; # … with 18,998 more rows</span></a></code></pre></div>
<p>Now we can complete the tidying by pivoting <code>variable</code> and <code>value</code> to make <code>TOTL</code> and <code>GROW</code> columns:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">pop3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(<span class="dt">names_from =</span> variable, <span class="dt">values_from =</span> value)</a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="co">#&gt; # A tibble: 9,504 x 5</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4"><span class="co">#&gt;    country area  year   TOTL    GROW</span></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="co">#&gt;  1 ABW     URB   2000  42444  1.18  </span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7"><span class="co">#&gt;  2 ABW     URB   2001  43048  1.41  </span></a>
<a class="sourceLine" id="cb35-8" data-line-number="8"><span class="co">#&gt;  3 ABW     URB   2002  43670  1.43  </span></a>
<a class="sourceLine" id="cb35-9" data-line-number="9"><span class="co">#&gt;  4 ABW     URB   2003  44246  1.31  </span></a>
<a class="sourceLine" id="cb35-10" data-line-number="10"><span class="co">#&gt;  5 ABW     URB   2004  44669  0.951 </span></a>
<a class="sourceLine" id="cb35-11" data-line-number="11"><span class="co">#&gt;  6 ABW     URB   2005  44889  0.491 </span></a>
<a class="sourceLine" id="cb35-12" data-line-number="12"><span class="co">#&gt;  7 ABW     URB   2006  44881 -0.0178</span></a>
<a class="sourceLine" id="cb35-13" data-line-number="13"><span class="co">#&gt;  8 ABW     URB   2007  44686 -0.435 </span></a>
<a class="sourceLine" id="cb35-14" data-line-number="14"><span class="co">#&gt;  9 ABW     URB   2008  44375 -0.698 </span></a>
<a class="sourceLine" id="cb35-15" data-line-number="15"><span class="co">#&gt; 10 ABW     URB   2009  44052 -0.731 </span></a>
<a class="sourceLine" id="cb35-16" data-line-number="16"><span class="co">#&gt; # … with 9,494 more rows</span></a></code></pre></div>
</div>
<div id="multi-choice" class="section level2">
<h2 class="hasAnchor">
<a href="#multi-choice" class="anchor"></a>Multi-choice</h2>
<p>Based on a suggestion by <a href="https://github.com/MaximeWack">Maxime Wack</a>, <a href="https://github.com/tidyverse/tidyr/issues/384" class="uri">https://github.com/tidyverse/tidyr/issues/384</a>), the final example shows how to deal with a common way of recording multiple choice data. Often you will get such data as follows:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">multi &lt;-<span class="st"> </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">  <span class="op">~</span>id, <span class="op">~</span>choice1, <span class="op">~</span>choice2, <span class="op">~</span>choice3,</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">  <span class="dv">1</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>,</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">  <span class="dv">2</span>, <span class="st">"C"</span>, <span class="st">"B"</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">  <span class="dv">3</span>, <span class="st">"D"</span>,  <span class="ot">NA</span>,  <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">  <span class="dv">4</span>, <span class="st">"B"</span>, <span class="st">"D"</span>,  <span class="ot">NA</span></a>
<a class="sourceLine" id="cb36-7" data-line-number="7">)</a></code></pre></div>
<p>But the actual order isn’t important, and you’d prefer to have the individual questions in the columns. You can achieve the desired transformation in two steps. First, you make the data longer, eliminating the explcit <code>NA</code>s, and adding a column to indicate that this choice was chosen:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">multi2 &lt;-<span class="st"> </span>multi <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_longer.html">pivot_longer</a></span>(<span class="op">-</span>id, <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">checked =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">multi2</a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="co">#&gt; # A tibble: 8 x 4</span></a>
<a class="sourceLine" id="cb37-6" data-line-number="6"><span class="co">#&gt;      id name    value checked</span></a>
<a class="sourceLine" id="cb37-7" data-line-number="7"><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;lgl&gt;  </span></a>
<a class="sourceLine" id="cb37-8" data-line-number="8"><span class="co">#&gt; 1     1 choice1 A     TRUE   </span></a>
<a class="sourceLine" id="cb37-9" data-line-number="9"><span class="co">#&gt; 2     1 choice2 B     TRUE   </span></a>
<a class="sourceLine" id="cb37-10" data-line-number="10"><span class="co">#&gt; 3     1 choice3 C     TRUE   </span></a>
<a class="sourceLine" id="cb37-11" data-line-number="11"><span class="co">#&gt; 4     2 choice1 C     TRUE   </span></a>
<a class="sourceLine" id="cb37-12" data-line-number="12"><span class="co">#&gt; 5     2 choice2 B     TRUE   </span></a>
<a class="sourceLine" id="cb37-13" data-line-number="13"><span class="co">#&gt; 6     3 choice1 D     TRUE   </span></a>
<a class="sourceLine" id="cb37-14" data-line-number="14"><span class="co">#&gt; 7     4 choice1 B     TRUE   </span></a>
<a class="sourceLine" id="cb37-15" data-line-number="15"><span class="co">#&gt; 8     4 choice2 D     TRUE</span></a></code></pre></div>
<p>Then you make the data wider, filling in the missing observations with <code>FALSE</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">multi2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(</a>
<a class="sourceLine" id="cb38-3" data-line-number="3">    <span class="dt">id_cols =</span> id,</a>
<a class="sourceLine" id="cb38-4" data-line-number="4">    <span class="dt">names_from =</span> value, </a>
<a class="sourceLine" id="cb38-5" data-line-number="5">    <span class="dt">values_from =</span> checked, </a>
<a class="sourceLine" id="cb38-6" data-line-number="6">    <span class="dt">values_fill =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">checked =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb38-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb38-8" data-line-number="8"><span class="co">#&gt; # A tibble: 4 x 5</span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9"><span class="co">#&gt;      id A     B     C     D    </span></a>
<a class="sourceLine" id="cb38-10" data-line-number="10"><span class="co">#&gt;   &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;</span></a>
<a class="sourceLine" id="cb38-11" data-line-number="11"><span class="co">#&gt; 1     1 TRUE  TRUE  TRUE  FALSE</span></a>
<a class="sourceLine" id="cb38-12" data-line-number="12"><span class="co">#&gt; 2     2 FALSE TRUE  TRUE  FALSE</span></a>
<a class="sourceLine" id="cb38-13" data-line-number="13"><span class="co">#&gt; 3     3 FALSE FALSE FALSE TRUE </span></a>
<a class="sourceLine" id="cb38-14" data-line-number="14"><span class="co">#&gt; 4     4 FALSE TRUE  FALSE TRUE</span></a></code></pre></div>
</div>
</div>
<div id="manual-specs" class="section level1">
<h1 class="hasAnchor">
<a href="#manual-specs" class="anchor"></a>Manual specs</h1>
<p>The arguments to <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> allow you to pivot a wide range of datasets. But the creativity that people apply to their data structures is seemingly endless, so it’s quite possible that you will encounter a dataset that you can’t immediately see how to reshape with <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code>. To gain more control over pivotting, you can instead create a “spec” data frame that describes exactly how data stored in the column names becomes variables (and vice versa). This section introduces you to the spec data structure, and show you how to use it when <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> are insufficient.</p>
<div id="longer-1" class="section level2">
<h2 class="hasAnchor">
<a href="#longer-1" class="anchor"></a>Longer</h2>
<p>To see how this works, lets return to the simplest case of pivotting applied to the <code>relig_income</code> dataset. Now pivotting happens in two steps: we first create a spec object (using <code><a href="../reference/pivot_longer_spec.html">build_longer_spec()</a></code>) then use that to describe the pivotting operation:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">spec &lt;-<span class="st"> </span>relig_income <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/pivot_longer_spec.html">build_longer_spec</a></span>(</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">  <span class="dt">cols =</span> <span class="op">-</span>religion, </a>
<a class="sourceLine" id="cb39-3" data-line-number="3">  <span class="dt">names_to =</span> <span class="st">"income"</span>,</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">  <span class="dt">values_to =</span> <span class="st">"count"</span></a>
<a class="sourceLine" id="cb39-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb39-6" data-line-number="6"><span class="kw"><a href="../reference/pivot_longer_spec.html">pivot_longer_spec</a></span>(relig_income, spec)</a>
<a class="sourceLine" id="cb39-7" data-line-number="7"><span class="co">#&gt; # A tibble: 180 x 3</span></a>
<a class="sourceLine" id="cb39-8" data-line-number="8"><span class="co">#&gt;    religion income             count</span></a>
<a class="sourceLine" id="cb39-9" data-line-number="9"><span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb39-10" data-line-number="10"><span class="co">#&gt;  1 Agnostic &lt;$10k                 27</span></a>
<a class="sourceLine" id="cb39-11" data-line-number="11"><span class="co">#&gt;  2 Agnostic $10-20k               34</span></a>
<a class="sourceLine" id="cb39-12" data-line-number="12"><span class="co">#&gt;  3 Agnostic $20-30k               60</span></a>
<a class="sourceLine" id="cb39-13" data-line-number="13"><span class="co">#&gt;  4 Agnostic $30-40k               81</span></a>
<a class="sourceLine" id="cb39-14" data-line-number="14"><span class="co">#&gt;  5 Agnostic $40-50k               76</span></a>
<a class="sourceLine" id="cb39-15" data-line-number="15"><span class="co">#&gt;  6 Agnostic $50-75k              137</span></a>
<a class="sourceLine" id="cb39-16" data-line-number="16"><span class="co">#&gt;  7 Agnostic $75-100k             122</span></a>
<a class="sourceLine" id="cb39-17" data-line-number="17"><span class="co">#&gt;  8 Agnostic $100-150k            109</span></a>
<a class="sourceLine" id="cb39-18" data-line-number="18"><span class="co">#&gt;  9 Agnostic &gt;150k                 84</span></a>
<a class="sourceLine" id="cb39-19" data-line-number="19"><span class="co">#&gt; 10 Agnostic Don't know/refused    96</span></a>
<a class="sourceLine" id="cb39-20" data-line-number="20"><span class="co">#&gt; # … with 170 more rows</span></a></code></pre></div>
<p>(This gives the same result as before, just with more code. There’s no need to use it here, it is presented as a simple example for using <code>spec</code>.)</p>
<p>What does <code>spec</code> look like? It’s a data frame with one row for each column, and two special columns that start with <code>.</code>:</p>
<ul>
<li>
<code>.name</code> gives the name of the column.</li>
<li>
<code>.value</code> gives the name of the column that the values in the cells will go into.</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">spec</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="co">#&gt; # A tibble: 10 x 3</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="co">#&gt;    .name              .value income            </span></a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt;              &lt;chr&gt;  &lt;chr&gt;             </span></a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="co">#&gt;  1 &lt;$10k              count  &lt;$10k             </span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="co">#&gt;  2 $10-20k            count  $10-20k           </span></a>
<a class="sourceLine" id="cb40-7" data-line-number="7"><span class="co">#&gt;  3 $20-30k            count  $20-30k           </span></a>
<a class="sourceLine" id="cb40-8" data-line-number="8"><span class="co">#&gt;  4 $30-40k            count  $30-40k           </span></a>
<a class="sourceLine" id="cb40-9" data-line-number="9"><span class="co">#&gt;  5 $40-50k            count  $40-50k           </span></a>
<a class="sourceLine" id="cb40-10" data-line-number="10"><span class="co">#&gt;  6 $50-75k            count  $50-75k           </span></a>
<a class="sourceLine" id="cb40-11" data-line-number="11"><span class="co">#&gt;  7 $75-100k           count  $75-100k          </span></a>
<a class="sourceLine" id="cb40-12" data-line-number="12"><span class="co">#&gt;  8 $100-150k          count  $100-150k         </span></a>
<a class="sourceLine" id="cb40-13" data-line-number="13"><span class="co">#&gt;  9 &gt;150k              count  &gt;150k             </span></a>
<a class="sourceLine" id="cb40-14" data-line-number="14"><span class="co">#&gt; 10 Don't know/refused count  Don't know/refused</span></a></code></pre></div>
</div>
<div id="wider-1" class="section level2">
<h2 class="hasAnchor">
<a href="#wider-1" class="anchor"></a>Wider</h2>
<p>Below we widen <code>us_rent_income</code> with <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code>. The result is ok, but I think it could be improved:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">us_rent_income <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_wider.html">pivot_wider</a></span>(<span class="dt">names_from =</span> variable, <span class="dt">values_from =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(estimate, moe))</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="co">#&gt; # A tibble: 52 x 6</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="co">#&gt;    GEOID NAME             estimate_income estimate_rent moe_income moe_rent</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                      &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb41-6" data-line-number="6"><span class="co">#&gt;  1 01    Alabama                    24476           747        136        3</span></a>
<a class="sourceLine" id="cb41-7" data-line-number="7"><span class="co">#&gt;  2 02    Alaska                     32940          1200        508       13</span></a>
<a class="sourceLine" id="cb41-8" data-line-number="8"><span class="co">#&gt;  3 04    Arizona                    27517           972        148        4</span></a>
<a class="sourceLine" id="cb41-9" data-line-number="9"><span class="co">#&gt;  4 05    Arkansas                   23789           709        165        5</span></a>
<a class="sourceLine" id="cb41-10" data-line-number="10"><span class="co">#&gt;  5 06    California                 29454          1358        109        3</span></a>
<a class="sourceLine" id="cb41-11" data-line-number="11"><span class="co">#&gt;  6 08    Colorado                   32401          1125        109        5</span></a>
<a class="sourceLine" id="cb41-12" data-line-number="12"><span class="co">#&gt;  7 09    Connecticut                35326          1123        195        5</span></a>
<a class="sourceLine" id="cb41-13" data-line-number="13"><span class="co">#&gt;  8 10    Delaware                   31560          1076        247       10</span></a>
<a class="sourceLine" id="cb41-14" data-line-number="14"><span class="co">#&gt;  9 11    District of Col…           43198          1424        681       17</span></a>
<a class="sourceLine" id="cb41-15" data-line-number="15"><span class="co">#&gt; 10 12    Florida                    25952          1077         70        3</span></a>
<a class="sourceLine" id="cb41-16" data-line-number="16"><span class="co">#&gt; # … with 42 more rows</span></a></code></pre></div>
<p>I think it would be better to have columns <code>income</code>, <code>rent</code>, <code>income_moe</code>, and <code>rent_moe</code>, which we can achieve with a manual spec. The current spec looks like this:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">spec1 &lt;-<span class="st"> </span>us_rent_income <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_wider_spec.html">build_wider_spec</a></span>(<span class="dt">names_from =</span> variable, <span class="dt">values_from =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(estimate, moe))</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">spec1</a>
<a class="sourceLine" id="cb42-4" data-line-number="4"><span class="co">#&gt; # A tibble: 4 x 3</span></a>
<a class="sourceLine" id="cb42-5" data-line-number="5"><span class="co">#&gt;   .name           .value   variable</span></a>
<a class="sourceLine" id="cb42-6" data-line-number="6"><span class="co">#&gt;   &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;   </span></a>
<a class="sourceLine" id="cb42-7" data-line-number="7"><span class="co">#&gt; 1 estimate_income estimate income  </span></a>
<a class="sourceLine" id="cb42-8" data-line-number="8"><span class="co">#&gt; 2 estimate_rent   estimate rent    </span></a>
<a class="sourceLine" id="cb42-9" data-line-number="9"><span class="co">#&gt; 3 moe_income      moe      income  </span></a>
<a class="sourceLine" id="cb42-10" data-line-number="10"><span class="co">#&gt; 4 moe_rent        moe      rent</span></a></code></pre></div>
<p>For this case, we mutate <code>spec</code> to carefully construct the column names:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">spec2 &lt;-<span class="st"> </span>spec1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">.name =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(variable, <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(.value <span class="op">==</span><span class="st"> "moe"</span>, <span class="st">"_moe"</span>, <span class="st">""</span>)))</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">spec2</a>
<a class="sourceLine" id="cb43-4" data-line-number="4"><span class="co">#&gt; # A tibble: 4 x 3</span></a>
<a class="sourceLine" id="cb43-5" data-line-number="5"><span class="co">#&gt;   .name      .value   variable</span></a>
<a class="sourceLine" id="cb43-6" data-line-number="6"><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;   </span></a>
<a class="sourceLine" id="cb43-7" data-line-number="7"><span class="co">#&gt; 1 income     estimate income  </span></a>
<a class="sourceLine" id="cb43-8" data-line-number="8"><span class="co">#&gt; 2 rent       estimate rent    </span></a>
<a class="sourceLine" id="cb43-9" data-line-number="9"><span class="co">#&gt; 3 income_moe moe      income  </span></a>
<a class="sourceLine" id="cb43-10" data-line-number="10"><span class="co">#&gt; 4 rent_moe   moe      rent</span></a></code></pre></div>
<p>Supplying this spec to <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code> gives us the result we’re looking for:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw"><a href="../reference/pivot_wider_spec.html">pivot_wider_spec</a></span>(us_rent_income, spec2)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="co">#&gt; # A tibble: 52 x 6</span></a>
<a class="sourceLine" id="cb44-3" data-line-number="3"><span class="co">#&gt;    GEOID NAME                 income  rent income_moe rent_moe</span></a>
<a class="sourceLine" id="cb44-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="co">#&gt;  1 01    Alabama               24476   747        136        3</span></a>
<a class="sourceLine" id="cb44-6" data-line-number="6"><span class="co">#&gt;  2 02    Alaska                32940  1200        508       13</span></a>
<a class="sourceLine" id="cb44-7" data-line-number="7"><span class="co">#&gt;  3 04    Arizona               27517   972        148        4</span></a>
<a class="sourceLine" id="cb44-8" data-line-number="8"><span class="co">#&gt;  4 05    Arkansas              23789   709        165        5</span></a>
<a class="sourceLine" id="cb44-9" data-line-number="9"><span class="co">#&gt;  5 06    California            29454  1358        109        3</span></a>
<a class="sourceLine" id="cb44-10" data-line-number="10"><span class="co">#&gt;  6 08    Colorado              32401  1125        109        5</span></a>
<a class="sourceLine" id="cb44-11" data-line-number="11"><span class="co">#&gt;  7 09    Connecticut           35326  1123        195        5</span></a>
<a class="sourceLine" id="cb44-12" data-line-number="12"><span class="co">#&gt;  8 10    Delaware              31560  1076        247       10</span></a>
<a class="sourceLine" id="cb44-13" data-line-number="13"><span class="co">#&gt;  9 11    District of Columbia  43198  1424        681       17</span></a>
<a class="sourceLine" id="cb44-14" data-line-number="14"><span class="co">#&gt; 10 12    Florida               25952  1077         70        3</span></a>
<a class="sourceLine" id="cb44-15" data-line-number="15"><span class="co">#&gt; # … with 42 more rows</span></a></code></pre></div>
</div>
<div id="by-hand" class="section level2">
<h2 class="hasAnchor">
<a href="#by-hand" class="anchor"></a>By hand</h2>
<p>Sometimes it’s not possible (or not convenient) to compute the spec, and instead it’s more convenient to construct the spec “by hand”. For example, take this <code>construction</code> data, which is lightly modified from Table 5 “completions” found at <a href="https://www.census.gov/construction/nrc/index.html" class="uri">https://www.census.gov/construction/nrc/index.html</a>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">construction</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="co">#&gt; # A tibble: 9 x 9</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="co">#&gt;    Year Month `1 unit` `2 to 4 units` `5 units or mor… Northeast Midwest</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;lgl&gt;                     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="co">#&gt; 1  2018 Janu…      859 NA                          348       114     169</span></a>
<a class="sourceLine" id="cb45-6" data-line-number="6"><span class="co">#&gt; 2  2018 Febr…      882 NA                          400       138     160</span></a>
<a class="sourceLine" id="cb45-7" data-line-number="7"><span class="co">#&gt; 3  2018 March      862 NA                          356       150     154</span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8"><span class="co">#&gt; 4  2018 April      797 NA                          447       144     196</span></a>
<a class="sourceLine" id="cb45-9" data-line-number="9"><span class="co">#&gt; 5  2018 May        875 NA                          364        90     169</span></a>
<a class="sourceLine" id="cb45-10" data-line-number="10"><span class="co">#&gt; 6  2018 June       867 NA                          342        76     170</span></a>
<a class="sourceLine" id="cb45-11" data-line-number="11"><span class="co">#&gt; 7  2018 July       829 NA                          360       108     183</span></a>
<a class="sourceLine" id="cb45-12" data-line-number="12"><span class="co">#&gt; 8  2018 Augu…      939 NA                          286        90     205</span></a>
<a class="sourceLine" id="cb45-13" data-line-number="13"><span class="co">#&gt; 9  2018 Sept…      835 NA                          304       117     175</span></a>
<a class="sourceLine" id="cb45-14" data-line-number="14"><span class="co">#&gt; # … with 2 more variables: South &lt;dbl&gt;, West &lt;dbl&gt;</span></a></code></pre></div>
<p>This sort of data is not uncommon from government agencies: the column names actually belong to different variables, and here we have summaries for number of units (1, 2-4, 5+) and regions of the country (NE, NW, midwest, S, W). We can most easily describe that with a tibble:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">spec &lt;-<span class="st"> </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">  <span class="op">~</span>.name,            <span class="op">~</span>.value, <span class="op">~</span>units,  <span class="op">~</span>region,     </a>
<a class="sourceLine" id="cb46-3" data-line-number="3">  <span class="st">"1 unit"</span>,          <span class="st">"n"</span>,     <span class="st">"1"</span>,     <span class="ot">NA</span>,          </a>
<a class="sourceLine" id="cb46-4" data-line-number="4">  <span class="st">"2 to 4 units"</span>,    <span class="st">"n"</span>,     <span class="st">"2-4"</span>,   <span class="ot">NA</span>,          </a>
<a class="sourceLine" id="cb46-5" data-line-number="5">  <span class="st">"5 units or more"</span>, <span class="st">"n"</span>,     <span class="st">"5+"</span>,    <span class="ot">NA</span>,          </a>
<a class="sourceLine" id="cb46-6" data-line-number="6">  <span class="st">"Northeast"</span>,       <span class="st">"n"</span>,     <span class="ot">NA</span>,      <span class="st">"Northeast"</span>, </a>
<a class="sourceLine" id="cb46-7" data-line-number="7">  <span class="st">"Midwest"</span>,         <span class="st">"n"</span>,     <span class="ot">NA</span>,      <span class="st">"Midwest"</span>,   </a>
<a class="sourceLine" id="cb46-8" data-line-number="8">  <span class="st">"South"</span>,           <span class="st">"n"</span>,     <span class="ot">NA</span>,      <span class="st">"South"</span>,     </a>
<a class="sourceLine" id="cb46-9" data-line-number="9">  <span class="st">"West"</span>,            <span class="st">"n"</span>,     <span class="ot">NA</span>,      <span class="st">"West"</span>,      </a>
<a class="sourceLine" id="cb46-10" data-line-number="10">)</a></code></pre></div>
<p>Which yields the following longer form:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw"><a href="../reference/pivot_longer_spec.html">pivot_longer_spec</a></span>(construction, spec)</a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="co">#&gt; # A tibble: 63 x 5</span></a>
<a class="sourceLine" id="cb47-3" data-line-number="3"><span class="co">#&gt;     Year Month    units region        n</span></a>
<a class="sourceLine" id="cb47-4" data-line-number="4"><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb47-5" data-line-number="5"><span class="co">#&gt;  1  2018 January  1     &lt;NA&gt;        859</span></a>
<a class="sourceLine" id="cb47-6" data-line-number="6"><span class="co">#&gt;  2  2018 January  2-4   &lt;NA&gt;         NA</span></a>
<a class="sourceLine" id="cb47-7" data-line-number="7"><span class="co">#&gt;  3  2018 January  5+    &lt;NA&gt;        348</span></a>
<a class="sourceLine" id="cb47-8" data-line-number="8"><span class="co">#&gt;  4  2018 January  &lt;NA&gt;  Northeast   114</span></a>
<a class="sourceLine" id="cb47-9" data-line-number="9"><span class="co">#&gt;  5  2018 January  &lt;NA&gt;  Midwest     169</span></a>
<a class="sourceLine" id="cb47-10" data-line-number="10"><span class="co">#&gt;  6  2018 January  &lt;NA&gt;  South       596</span></a>
<a class="sourceLine" id="cb47-11" data-line-number="11"><span class="co">#&gt;  7  2018 January  &lt;NA&gt;  West        339</span></a>
<a class="sourceLine" id="cb47-12" data-line-number="12"><span class="co">#&gt;  8  2018 February 1     &lt;NA&gt;        882</span></a>
<a class="sourceLine" id="cb47-13" data-line-number="13"><span class="co">#&gt;  9  2018 February 2-4   &lt;NA&gt;         NA</span></a>
<a class="sourceLine" id="cb47-14" data-line-number="14"><span class="co">#&gt; 10  2018 February 5+    &lt;NA&gt;        400</span></a>
<a class="sourceLine" id="cb47-15" data-line-number="15"><span class="co">#&gt; # … with 53 more rows</span></a></code></pre></div>
<p>Note that there is no overlap between the <code>units</code> and <code>region</code> variables; here the data would really be most naturally described in two independent tables.</p>
</div>
<div id="theory" class="section level2">
<h2 class="hasAnchor">
<a href="#theory" class="anchor"></a>Theory</h2>
<p>One neat property of the <code>spec</code> is that you need the same spec for <code><a href="../reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="../reference/pivot_wider.html">pivot_wider()</a></code>. This makes it very clear that the two operations are symmetric:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">construction <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pivot_longer_spec.html">pivot_longer_spec</a></span>(spec) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb48-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/pivot_wider_spec.html">pivot_wider_spec</a></span>(spec)</a>
<a class="sourceLine" id="cb48-4" data-line-number="4"><span class="co">#&gt; # A tibble: 9 x 9</span></a>
<a class="sourceLine" id="cb48-5" data-line-number="5"><span class="co">#&gt;    Year Month `1 unit` `2 to 4 units` `5 units or mor… Northeast Midwest</span></a>
<a class="sourceLine" id="cb48-6" data-line-number="6"><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb48-7" data-line-number="7"><span class="co">#&gt; 1  2018 Janu…      859             NA              348       114     169</span></a>
<a class="sourceLine" id="cb48-8" data-line-number="8"><span class="co">#&gt; 2  2018 Febr…      882             NA              400       138     160</span></a>
<a class="sourceLine" id="cb48-9" data-line-number="9"><span class="co">#&gt; 3  2018 March      862             NA              356       150     154</span></a>
<a class="sourceLine" id="cb48-10" data-line-number="10"><span class="co">#&gt; 4  2018 April      797             NA              447       144     196</span></a>
<a class="sourceLine" id="cb48-11" data-line-number="11"><span class="co">#&gt; 5  2018 May        875             NA              364        90     169</span></a>
<a class="sourceLine" id="cb48-12" data-line-number="12"><span class="co">#&gt; 6  2018 June       867             NA              342        76     170</span></a>
<a class="sourceLine" id="cb48-13" data-line-number="13"><span class="co">#&gt; 7  2018 July       829             NA              360       108     183</span></a>
<a class="sourceLine" id="cb48-14" data-line-number="14"><span class="co">#&gt; 8  2018 Augu…      939             NA              286        90     205</span></a>
<a class="sourceLine" id="cb48-15" data-line-number="15"><span class="co">#&gt; 9  2018 Sept…      835             NA              304       117     175</span></a>
<a class="sourceLine" id="cb48-16" data-line-number="16"><span class="co">#&gt; # … with 2 more variables: South &lt;dbl&gt;, West &lt;dbl&gt;</span></a></code></pre></div>
<p>The pivotting spec allows us to be more precise about exactly how <code><a href="../reference/pivot_longer.html">pivot_longer(df, spec = spec)</a></code> changes the shape of <code>df</code>: it will have <code>nrow(df) * nrow(spec)</code> rows, and <code>ncol(df) - nrow(spec) + ncol(spec) - 2</code> columns.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#longer">Longer</a><ul class="nav nav-pills nav-stacked">
<li><a href="#pew">String data in column names</a></li>
      <li><a href="#billboard">Numeric data in column names</a></li>
      <li><a href="#many-variables-in-column-names">Many variables in column names</a></li>
      <li><a href="#multiple-observations-per-row">Multiple observations per row</a></li>
      <li><a href="#duplicated-column-names">Duplicated column names</a></li>
      </ul>
</li>
      <li>
<a href="#wider">Wider</a><ul class="nav nav-pills nav-stacked">
<li><a href="#capture-recapture-data">Capture-recapture data</a></li>
      <li><a href="#aggregation">Aggregation</a></li>
      <li><a href="#generate-column-name-from-multiple-variables">Generate column name from multiple variables</a></li>
      <li><a href="#tidy-census">Tidy census</a></li>
      <li><a href="#contact-list">Contact list</a></li>
      </ul>
</li>
      <li>
<a href="#longer-then-wider">Longer, then wider</a><ul class="nav nav-pills nav-stacked">
<li><a href="#world-bank">World bank</a></li>
      <li><a href="#multi-choice">Multi-choice</a></li>
      </ul>
</li>
      <li>
<a href="#manual-specs">Manual specs</a><ul class="nav nav-pills nav-stacked">
<li><a href="#longer-1">Longer</a></li>
      <li><a href="#wider-1">Wider</a></li>
      <li><a href="#by-hand">By hand</a></li>
      <li><a href="#theory">Theory</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="tidyverse">
  <p>tidyr is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href="http://hadley.nz">Hadley Wickham</a>, Lionel Henry.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
