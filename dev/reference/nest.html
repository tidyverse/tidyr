<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Nest and unnest — nest • tidyr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">



<meta property="og:title" content="Nest and unnest — nest" />
<meta property="og:description" content="Nesting creates a list-column of data frames; unnesting flattens it back out
into regular columns. Nesting is implicitly a summarising operation: you
get one row for each group defined by the non-nested columns. This is useful
in conjunction with other summaries that work with whole datasets, most
notably models.
Learn more in vignette(&quot;nest&quot;)." />
<meta property="og:image" content="https://tidyr.tidyverse.org/logo.png" />
<meta name="twitter:card" content="summary" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">tidyr</a>
        <div class="info">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.0.2.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/tidy-data.html">Tidy data</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/in-packages.html">In packages</a>
    </li>
    <li>
      <a href="../articles/nest.html">Nested data</a>
    </li>
    <li>
      <a href="../articles/pivot.html">Pivoting</a>
    </li>
    <li>
      <a href="../articles/rectangle.html">Rectangling</a>
    </li>
    <li>
      <a href="../articles/tidy-data.html">Tidy data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/09/tidyr-1-0-0/">Version 1.0.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/02/tidyr-0-8-0/">Version 0.8.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2017/08/tidyr-0.7.0/">Version 0.7.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2016/08/15/tidyr-0-6-0/">Version 0.6.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2016/06/13/tidyr-0-5-0/">Version 0.5.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2016/02/02/tidyr-0-4-0/">Version 0.5.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2015/09/13/tidyr-0-3-0/">Version 0.4.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2014/12/08/tidyr-0-2-0/">Version 0.2.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2014/07/22/introducing-tidyr/">Version 0.1.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/tidyverse/tidyr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Nest and unnest</h1>
    <small class="dont-index">Source: <a href='https://github.com/tidyverse/tidyr/blob/master/R/nest.R'><code>R/nest.R</code></a></small>
    <div class="hidden name"><code>nest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Nesting creates a list-column of data frames; unnesting flattens it back out
into regular columns. Nesting is implicitly a summarising operation: you
get one row for each group defined by the non-nested columns. This is useful
in conjunction with other summaries that work with whole datasets, most
notably models.</p>
<p>Learn more in <code><a href='../articles/nest.html'>vignette("nest")</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>nest</span>(<span class='no'>.data</span>, <span class='no'>...</span>, <span class='kw'>.names_sep</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>.key</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Deprecated.html'>deprecated</a></span>())

<span class='fu'>unnest</span>(
  <span class='no'>data</span>,
  <span class='no'>cols</span>,
  <span class='no'>...</span>,
  <span class='kw'>keep_empty</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>ptype</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>names_sep</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>names_repair</span> <span class='kw'>=</span> <span class='st'>"check_unique"</span>,
  <span class='kw'>.drop</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Deprecated.html'>deprecated</a></span>(),
  <span class='kw'>.id</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Deprecated.html'>deprecated</a></span>(),
  <span class='kw'>.sep</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Deprecated.html'>deprecated</a></span>(),
  <span class='kw'>.preserve</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Deprecated.html'>deprecated</a></span>()
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>.data</th>
      <td><p>A data frame.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Name-variable pairs of the form <code>new_col = c(col1, col2, col3)</code>,
that describe how you wish to nest existing columns into new columns.
The right hand side can be any expression supported by tidyselect.</p>
<p><img src='figures/lifecycle-deprecated.svg' alt='Deprecated lifecycle' />
:
previously you could write <code>df %&gt;% nest(x, y, z)</code> and <code>df %&gt;% unnest(x, y, z)</code>. Convert to <code>df %&gt;% nest(data = c(x, y, z))</code>.
and <code>df %&gt;% unnest(c(x, y, z))</code>.</p>
<p>If you previously created new variable in <code>unnest()</code> you'll now need to
do it explicitly with <code>mutate()</code>. Convert <code>df %&gt;% unnest(y = fun(x, y, z))</code>
to <code>df %&gt;% mutate(y = fun(x, y, z)) %&gt;% unnest(y)</code>.</p></td>
    </tr>
    <tr>
      <th>.key</th>
      <td><p><img src='figures/lifecycle-deprecated.svg' alt='Deprecated lifecycle' />
:
No longer needed because of the new <code>new_col = c(col1, col2, col3)</code> syntax.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A data frame.</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>Names of columns to unnest.</p>
<p>If you <code>unnest()</code> multiple columns, parallel entries must be of
compatible sizes, i.e. they're either equal or length 1 (following the
standard tidyverse recycling rules).</p></td>
    </tr>
    <tr>
      <th>keep_empty</th>
      <td><p>By default, you get one row of output for each element
of the list your unchopping/unnesting. This means that if there's a
size-0 element (like <code>NULL</code> or an empty data frame), that entire row
will be dropped from the output. If you want to preserve all rows,
use <code>keep_empty = TRUE</code> to replace size-0 elements with a single row
of missing values.</p></td>
    </tr>
    <tr>
      <th>ptype</th>
      <td><p>Optionally, supply a data frame prototype for the output <code>cols</code>,
overriding the default that will be guessed from the combination of
individual values.</p></td>
    </tr>
    <tr>
      <th>names_sep, .names_sep</th>
      <td><p>If <code>NULL</code>, the default, the names will be left
as is. In <code>nest()</code>, inner names will come from the former outer names;
in <code>unnest()</code>, the new outer names will come from the inner names.</p>
<p>If a string, the inner and outer names will be used together. In <code>nest()</code>,
the names of the new outer columns will be formed by pasting together the
outer and the inner column names, separated by <code>names_sep</code>. In <code>unnest()</code>,
the new inner names will have the outer names (+ <code>names_sep</code>) automatically
stripped. This makes <code>names_sep</code> roughly symmetric between nesting and
unnesting.</p></td>
    </tr>
    <tr>
      <th>names_repair</th>
      <td><p>Used to check that output data frame has valid
names. Must be one of the following options:</p><ul>
<li><p>"minimal": no name repair or checks, beyond basic existence,</p></li>
<li><p>"unique": make sure names are unique and not empty,</p></li>
<li><p>"check_unique": (the default), no name repair, but check they are unique,</p></li>
<li><p>"universal": make the names unique and syntactic</p></li>
<li><p>a function: apply custom name repair.</p></li>
<li><p><a href='tidyr_legacy.html'>tidyr_legacy</a>: use the name repair from tidyr 0.8.</p></li>
<li><p>a formula: a purrr-style anonymous function (see <code><a href='https://rlang.r-lib.org/reference/as_function.html'>rlang::as_function()</a></code>)</p></li>
</ul>

<p>See <code><a href='https://rdrr.io/pkg/vctrs/man/vec_as_names.html'>vctrs::vec_as_names()</a></code> for more details on these terms and the
strategies used to enforce them.</p></td>
    </tr>
    <tr>
      <th>.drop, .preserve</th>
      <td><p><img src='figures/lifecycle-deprecated.svg' alt='Deprecated lifecycle' />
:
all list-columns are now preserved; If there are any that you
don't want in the output use <code>select()</code> to remove them prior to
unnesting.</p></td>
    </tr>
    <tr>
      <th>.id</th>
      <td><p><img src='figures/lifecycle-deprecated.svg' alt='Deprecated lifecycle' />
:
convert <code>df %&gt;% unnest(x, .id = "id")</code> to <code>df %&gt;% mutate(id = names(x)) %&gt;% unnest(x))</code>.</p></td>
    </tr>
    <tr>
      <th>.sep</th>
      <td><p><img src='figures/lifecycle-deprecated.svg' alt='Deprecated lifecycle' />
:
use <code>names_sep</code> instead.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="new-syntax"><a class="anchor" href="#new-syntax"></a>New syntax</h2>

    

<p>tidyr 1.0.0 introduced a new syntax for <code>nest()</code> and <code>unnest()</code> that's
designed to be more similar to other functions. Converting to the new syntax
should be straightforward (guided by the message you'll recieve) but if
you just need to run an old analysis, you can easily revert to the previous
behaviour using <code><a href='nest_legacy.html'>nest_legacy()</a></code> and <code><a href='nest_legacy.html'>unnest_legacy()</a></code> as follows:</p><pre><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>tidyr</span>)
<span class='no'>nest</span> <span class='kw'>&amp;</span><span class='no'>lt</span>;- <span class='no'>nest_legacy</span>
<span class='no'>unnest</span> <span class='kw'>&amp;</span><span class='no'>lt</span>;- <span class='no'>unnest_legacy</span></pre>

    <h2 class="hasAnchor" id="grouped-data-frames"><a class="anchor" href="#grouped-data-frames"></a>Grouped data frames</h2>

    

<p><code>df %&gt;% nest(x, y)</code> specifies the columns to be nested; i.e. the columns that
will appear in the inner data frame. Alternatively, you can <code>nest()</code> a
grouped data frame created by <code><a href='https://dplyr.tidyverse.org/reference/group_by.html'>dplyr::group_by()</a></code>. The grouping variables
remain in the outer data frame and the others are nested. The result
preserves the grouping of the input.</p>
<p>Variables supplied to <code>nest()</code> will override grouping variables so that
<code>df %&gt;% group_by(x, y) %&gt;% nest(z)</code> will be equivalent to <code>df %&gt;% nest(z)</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>3</span>), <span class='kw'>y</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>6</span>, <span class='kw'>z</span> <span class='kw'>=</span> <span class='fl'>6</span>:<span class='fl'>1</span>)
<span class='co'># Note that we get one row of output for each unique combination of</span>
<span class='co'># non-nested variables</span>
<span class='no'>df</span> <span class='kw'>%&gt;%</span> <span class='fu'>nest</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>y</span>, <span class='no'>z</span>))</div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 3 x 2</span><span>
#&gt;       x data            
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>          
#&gt; </span><span style='color: #555555;'>1</span><span>     1 </span><span style='color: #555555;'>&lt;tibble [3 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>2</span><span>     2 </span><span style='color: #555555;'>&lt;tibble [2 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>3</span><span>     3 </span><span style='color: #555555;'>&lt;tibble [1 × 2]&gt;</span><span></div><div class='input'><span class='co'># chop does something similar, but retains individual columns</span>
<span class='no'>df</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='chop.html'>chop</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>y</span>, <span class='no'>z</span>))</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 3 x 3</span><span>
#&gt;       x           y           z
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&lt;int&gt;&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&lt;int&gt;&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span>     1         </span><span style='color: #555555;'>[3]</span><span>         </span><span style='color: #555555;'>[3]</span><span>
#&gt; </span><span style='color: #555555;'>2</span><span>     2         </span><span style='color: #555555;'>[2]</span><span>         </span><span style='color: #555555;'>[2]</span><span>
#&gt; </span><span style='color: #555555;'>3</span><span>     3         </span><span style='color: #555555;'>[1]</span><span>         </span><span style='color: #555555;'>[1]</span><span></div><div class='input'>
<span class='co'># use tidyselect syntax and helpers, just like in dplyr::select()</span>
<span class='no'>df</span> <span class='kw'>%&gt;%</span> <span class='fu'>nest</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/one_of.html'>one_of</a></span>(<span class='st'>"y"</span>, <span class='st'>"z"</span>))</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 3 x 2</span><span>
#&gt;       x data            
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>          
#&gt; </span><span style='color: #555555;'>1</span><span>     1 </span><span style='color: #555555;'>&lt;tibble [3 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>2</span><span>     2 </span><span style='color: #555555;'>&lt;tibble [2 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>3</span><span>     3 </span><span style='color: #555555;'>&lt;tibble [1 × 2]&gt;</span><span></div><div class='input'>
<span class='no'>iris</span> <span class='kw'>%&gt;%</span> <span class='fu'>nest</span>(<span class='kw'>data</span> <span class='kw'>=</span> -<span class='no'>Species</span>)</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 3 x 2</span><span>
#&gt;   Species    data             
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>           
#&gt; </span><span style='color: #555555;'>1</span><span> setosa     </span><span style='color: #555555;'>&lt;tibble [50 × 4]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>2</span><span> versicolor </span><span style='color: #555555;'>&lt;tibble [50 × 4]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>3</span><span> virginica  </span><span style='color: #555555;'>&lt;tibble [50 × 4]&gt;</span><span></div><div class='input'><span class='no'>nest_vars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>iris</span>)[<span class='fl'>1</span>:<span class='fl'>4</span>]
<span class='no'>iris</span> <span class='kw'>%&gt;%</span> <span class='fu'>nest</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/one_of.html'>one_of</a></span>(<span class='no'>nest_vars</span>))</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 3 x 2</span><span>
#&gt;   Species    data             
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>           
#&gt; </span><span style='color: #555555;'>1</span><span> setosa     </span><span style='color: #555555;'>&lt;tibble [50 × 4]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>2</span><span> versicolor </span><span style='color: #555555;'>&lt;tibble [50 × 4]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>3</span><span> virginica  </span><span style='color: #555555;'>&lt;tibble [50 × 4]&gt;</span><span></div><div class='input'><span class='no'>iris</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>nest</span>(<span class='kw'>petal</span> <span class='kw'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/select_helpers.html'>starts_with</a></span>(<span class='st'>"Petal"</span>), <span class='kw'>sepal</span> <span class='kw'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/select_helpers.html'>starts_with</a></span>(<span class='st'>"Sepal"</span>))</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 3 x 3</span><span>
#&gt;   Species    petal             sepal            
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>           
#&gt; </span><span style='color: #555555;'>1</span><span> setosa     </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span> </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>2</span><span> versicolor </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span> </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>3</span><span> virginica  </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span> </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span></div><div class='input'><span class='no'>iris</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>nest</span>(<span class='kw'>width</span> <span class='kw'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/select_helpers.html'>contains</a></span>(<span class='st'>"Width"</span>), <span class='kw'>length</span> <span class='kw'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/select_helpers.html'>contains</a></span>(<span class='st'>"Length"</span>))</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 3 x 3</span><span>
#&gt;   Species    width             length           
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>           
#&gt; </span><span style='color: #555555;'>1</span><span> setosa     </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span> </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>2</span><span> versicolor </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span> </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>3</span><span> virginica  </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span> </span><span style='color: #555555;'>&lt;tibble [50 × 2]&gt;</span><span></div><div class='input'>
<span class='co'># Nesting a grouped data frame nests all variables apart from the group vars</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>)
<span class='no'>fish_encounters</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span>(<span class='no'>fish</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>nest</span>()</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 19 x 2</span><span>
#&gt; </span><span style='color: #555555;'># Groups:   fish [19]</span><span>
#&gt;    fish  data             
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;fct&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>           
#&gt; </span><span style='color: #555555;'> 1</span><span> 4842  </span><span style='color: #555555;'>&lt;tibble [11 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 2</span><span> 4843  </span><span style='color: #555555;'>&lt;tibble [11 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 3</span><span> 4844  </span><span style='color: #555555;'>&lt;tibble [11 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 4</span><span> 4845  </span><span style='color: #555555;'>&lt;tibble [5 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'> 5</span><span> 4847  </span><span style='color: #555555;'>&lt;tibble [3 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'> 6</span><span> 4848  </span><span style='color: #555555;'>&lt;tibble [4 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'> 7</span><span> 4849  </span><span style='color: #555555;'>&lt;tibble [2 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'> 8</span><span> 4850  </span><span style='color: #555555;'>&lt;tibble [6 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'> 9</span><span> 4851  </span><span style='color: #555555;'>&lt;tibble [2 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'>10</span><span> 4854  </span><span style='color: #555555;'>&lt;tibble [2 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'>11</span><span> 4855  </span><span style='color: #555555;'>&lt;tibble [5 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'>12</span><span> 4857  </span><span style='color: #555555;'>&lt;tibble [9 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'>13</span><span> 4858  </span><span style='color: #555555;'>&lt;tibble [11 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>14</span><span> 4859  </span><span style='color: #555555;'>&lt;tibble [5 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'>15</span><span> 4861  </span><span style='color: #555555;'>&lt;tibble [11 × 2]&gt;</span><span>
#&gt; </span><span style='color: #555555;'>16</span><span> 4862  </span><span style='color: #555555;'>&lt;tibble [9 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'>17</span><span> 4863  </span><span style='color: #555555;'>&lt;tibble [2 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'>18</span><span> 4864  </span><span style='color: #555555;'>&lt;tibble [2 × 2]&gt;</span><span> 
#&gt; </span><span style='color: #555555;'>19</span><span> 4865  </span><span style='color: #555555;'>&lt;tibble [3 × 2]&gt;</span><span> </div><div class='input'>
<span class='co'># Nesting is often useful for creating per group models</span>
<span class='no'>mtcars</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span>(<span class='no'>cyl</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>nest</span>() <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(<span class='kw'>models</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>data</span>, <span class='kw'>function</span>(<span class='no'>df</span>) <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span>(<span class='no'>mpg</span> ~ <span class='no'>wt</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>df</span>)))</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 3 x 3</span><span>
#&gt; </span><span style='color: #555555;'># Groups:   cyl [3]</span><span>
#&gt;     cyl data               models
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>             </span><span style='color: #555555;font-style: italic;'>&lt;list&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span>     6 </span><span style='color: #555555;'>&lt;tibble [7 × 10]&gt;</span><span>  </span><span style='color: #555555;'>&lt;lm&gt;</span><span>  
#&gt; </span><span style='color: #555555;'>2</span><span>     4 </span><span style='color: #555555;'>&lt;tibble [11 × 10]&gt;</span><span> </span><span style='color: #555555;'>&lt;lm&gt;</span><span>  
#&gt; </span><span style='color: #555555;'>3</span><span>     8 </span><span style='color: #555555;'>&lt;tibble [14 × 10]&gt;</span><span> </span><span style='color: #555555;'>&lt;lm&gt;</span><span>  </div><div class='input'>
<span class='co'># unnest() is primarily designed to work with lists of data frames</span>
<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(
  <span class='kw'>x</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>3</span>,
  <span class='kw'>y</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
    <span class='kw'>NULL</span>,
    <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='fl'>2</span>),
    <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>3</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='fl'>3</span>:<span class='fl'>1</span>)
  )
)
<span class='no'>df</span> <span class='kw'>%&gt;%</span> <span class='fu'>unnest</span>(<span class='no'>y</span>)</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 4 x 3</span><span>
#&gt;       x     a     b
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span>     2     1     2
#&gt; </span><span style='color: #555555;'>2</span><span>     3     1     3
#&gt; </span><span style='color: #555555;'>3</span><span>     3     2     2
#&gt; </span><span style='color: #555555;'>4</span><span>     3     3     1</div><div class='input'><span class='no'>df</span> <span class='kw'>%&gt;%</span> <span class='fu'>unnest</span>(<span class='no'>y</span>, <span class='kw'>keep_empty</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 5 x 3</span><span>
#&gt;       x     a     b
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span>     1    </span><span style='color: #BB0000;'>NA</span><span>    </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #555555;'>2</span><span>     2     1     2
#&gt; </span><span style='color: #555555;'>3</span><span>     3     1     3
#&gt; </span><span style='color: #555555;'>4</span><span>     3     2     2
#&gt; </span><span style='color: #555555;'>5</span><span>     3     3     1</div><div class='input'>
<span class='co'># If you have lists of lists, or lists of atomic vectors, instead</span>
<span class='co'># see hoist(), unnest_wider(), and unnest_longer()</span>

<span class='co'>#' # You can unnest multiple columns simultaneously</span>
<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(
 <span class='kw'>a</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>), <span class='st'>"c"</span>),
 <span class='kw'>b</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>, <span class='fl'>3</span>),
 <span class='kw'>c</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>11</span>, <span class='fl'>22</span>)
)
<span class='no'>df</span> <span class='kw'>%&gt;%</span> <span class='fu'>unnest</span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>a</span>, <span class='no'>b</span>))</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 3 x 3</span><span>
#&gt;   a         b     c
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> a         1    11
#&gt; </span><span style='color: #555555;'>2</span><span> b         2    11
#&gt; </span><span style='color: #555555;'>3</span><span> c         3    22</div><div class='input'>
<span class='co'># Compare with unnesting one column at a time, which generates</span>
<span class='co'># the Cartesian product</span>
<span class='no'>df</span> <span class='kw'>%&gt;%</span> <span class='fu'>unnest</span>(<span class='no'>a</span>) <span class='kw'>%&gt;%</span> <span class='fu'>unnest</span>(<span class='no'>b</span>)</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 5 x 3</span><span>
#&gt;   a         b     c
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> a         1    11
#&gt; </span><span style='color: #555555;'>2</span><span> a         2    11
#&gt; </span><span style='color: #555555;'>3</span><span> b         1    11
#&gt; </span><span style='color: #555555;'>4</span><span> b         2    11
#&gt; </span><span style='color: #555555;'>5</span><span> c         3    22</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p>tidyr is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, Lionel Henry.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>


